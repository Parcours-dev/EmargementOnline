"use strict";(self.webpackChunkdigitalisation_emargement_frontend=self.webpackChunkdigitalisation_emargement_frontend||[]).push([[958],{958:(D,u,a)=>{a.r(u),a.d(u,{RapportAbsenceComponent:()=>M});var e=a(8457),m=a(7028),f=a(7136),d=a(177),l=a(4341),_=a(1626);function c(r,p){1&r&&(e.j41(0,"th"),e.EFF(1,"IP"),e.k0s())}function g(r,p){1&r&&(e.j41(0,"th"),e.EFF(1,"User Agent"),e.k0s())}function h(r,p){1&r&&(e.j41(0,"th"),e.EFF(1,"Ajout manuel"),e.k0s())}function R(r,p){if(1&r&&(e.j41(0,"td"),e.EFF(1),e.k0s()),2&r){const o=e.XpG().$implicit;e.R7$(),e.JRh(o.ip_adresse||"")}}function b(r,p){if(1&r&&(e.j41(0,"td"),e.EFF(1),e.k0s()),2&r){const o=e.XpG().$implicit;e.R7$(),e.JRh((null==o.user_agent?null:o.user_agent.substring(0,30))||"")}}function E(r,p){if(1&r&&(e.j41(0,"td"),e.EFF(1),e.k0s()),2&r){const o=e.XpG().$implicit;e.R7$(),e.JRh(o.ajout_manuel?"Oui":"Non")}}function F(r,p){if(1&r&&(e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.k0s(),e.j41(9,"td",32),e.EFF(10),e.k0s(),e.DNE(11,R,2,1,"td",30)(12,b,2,1,"td",30)(13,E,2,1,"td",30),e.k0s()),2&r){const o=p.$implicit,s=e.XpG();e.R7$(2),e.Lme("",o.nom," ",o.prenom,""),e.R7$(2),e.JRh(o.nom_cours),e.R7$(2),e.JRh(o.date_heure_debut),e.R7$(2),e.JRh(o.date_heure_fin),e.R7$(),e.Y8G("ngClass",o.present?"text-success":"text-danger"),e.R7$(),e.SpI(" ",o.present?"\u2705 Pr\xe9sent":"\u274c Absent"," "),e.R7$(),e.Y8G("ngIf",s.filtres.includeDetails),e.R7$(),e.Y8G("ngIf",s.filtres.includeDetails),e.R7$(),e.Y8G("ngIf",s.filtres.includeDetails)}}function C(r,p){1&r&&(e.j41(0,"tr")(1,"td",33),e.EFF(2,"Aucun r\xe9sultat \xe0 afficher."),e.k0s()())}let M=(()=>{class r{API="http://localhost:3000/api";http=(0,e.WQX)(_.Qq);headers=null;resultats=[];filtres={promo:"",id_groupe_TD:"",id_groupe_Anglais:"",email:"",date:"",from:"",to:"",type:"",includeDetails:!1};ngOnInit(){const o=localStorage.getItem("_TOKEN_UTILISATEUR");if(o){const s=JSON.parse(o);this.headers=(new _.Lr).set("Authorization",`Bearer ${s.token}`)}}appliquerFiltres(){if(!this.headers)return;const o=new URLSearchParams;Object.entries(this.filtres).forEach(([s,t])=>{"boolean"==typeof t?t&&o.append(s,"true"):t&&o.append(s,t)}),this.http.get(`${this.API}/cfa/export?${o.toString()}`,{headers:this.headers}).subscribe({next:s=>this.resultats=s,error:()=>console.error("\u274c Erreur chargement des pr\xe9sences")})}exporter(){if(!this.headers)return;if(0===this.resultats.length)return void alert("Aucune donn\xe9e \xe0 exporter. Appliquez des filtres d'abord.");const o=new URLSearchParams;Object.entries(this.filtres).forEach(([s,t])=>{"boolean"==typeof t?t&&o.append(s,"true"):t&&o.append(s,t)}),o.append("export","true"),this.http.get(`${this.API}/cfa/export-file?${o.toString()}`,{headers:this.headers,responseType:"blob"}).subscribe({next:s=>{const t=`export_${(new Date).toISOString().slice(0,10)}.xlsx`,i=window.URL.createObjectURL(s),n=document.createElement("a");n.href=i,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(i)},error:()=>{console.error("\u274c Erreur export fichier"),alert("Erreur lors de l'export. V\xe9rifiez votre connexion ou token.")}})}static \u0275fac=function(s){return new(s||r)};static \u0275cmp=e.VBU({type:r,selectors:[["app-rapport-absence"]],decls:77,vars:14,consts:[[1,"grayed-background","main-content"],[1,"container"],[1,"mb-4"],[1,"card","p-4","mb-4",3,"ngSubmit"],[1,"row","g-3"],[1,"col-md-4"],[1,"form-label"],["name","promo","placeholder","Ex: 2023-A",1,"form-control",3,"ngModelChange","ngModel"],["name","id_groupe_TD",1,"form-control",3,"ngModelChange","ngModel"],["name","id_groupe_Anglais",1,"form-control",3,"ngModelChange","ngModel"],["name","email",1,"form-control",3,"ngModelChange","ngModel"],["type","date","name","date",1,"form-control",3,"ngModelChange","ngModel"],[1,"d-flex","gap-2"],["type","date","name","from",1,"form-control",3,"ngModelChange","ngModel"],["type","date","name","to",1,"form-control",3,"ngModelChange","ngModel"],["name","type",1,"form-select",3,"ngModelChange","ngModel"],["value",""],["value","presents"],["value","absents"],[1,"col-md-4","d-flex","align-items-center"],[1,"form-check","mt-4"],["type","checkbox","id","withInfos","name","includeDetails",1,"form-check-input",3,"ngModelChange","ngModel"],["for","withInfos",1,"form-check-label"],[1,"d-flex","gap-3","mt-4"],["type","submit",1,"btn","btn-primary"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"card","p-3"],[1,"mb-3"],[1,"table-responsive"],[1,"table","table-bordered"],[4,"ngIf"],[4,"ngFor","ngForOf"],[3,"ngClass"],["colspan","8",1,"text-center","text-muted"]],template:function(s,t){1&s&&(e.nrm(0,"app-header"),e.j41(1,"main",0)(2,"div",1)(3,"h2",2),e.EFF(4,"\u{1f4ca} Rapport des Absences"),e.k0s(),e.j41(5,"form",3),e.bIt("ngSubmit",function(){return t.appliquerFiltres()}),e.j41(6,"div",4)(7,"div",5)(8,"label",6),e.EFF(9,"Promotion"),e.k0s(),e.j41(10,"input",7),e.mxI("ngModelChange",function(n){return e.DH7(t.filtres.promo,n)||(t.filtres.promo=n),n}),e.k0s()(),e.j41(11,"div",5)(12,"label",6),e.EFF(13,"Groupe TD"),e.k0s(),e.j41(14,"input",8),e.mxI("ngModelChange",function(n){return e.DH7(t.filtres.id_groupe_TD,n)||(t.filtres.id_groupe_TD=n),n}),e.k0s()(),e.j41(15,"div",5)(16,"label",6),e.EFF(17,"Groupe Anglais"),e.k0s(),e.j41(18,"input",9),e.mxI("ngModelChange",function(n){return e.DH7(t.filtres.id_groupe_Anglais,n)||(t.filtres.id_groupe_Anglais=n),n}),e.k0s()(),e.j41(19,"div",5)(20,"label",6),e.EFF(21,"Email \xe9tudiant"),e.k0s(),e.j41(22,"input",10),e.mxI("ngModelChange",function(n){return e.DH7(t.filtres.email,n)||(t.filtres.email=n),n}),e.k0s()(),e.j41(23,"div",5)(24,"label",6),e.EFF(25,"Date unique"),e.k0s(),e.j41(26,"input",11),e.mxI("ngModelChange",function(n){return e.DH7(t.filtres.date,n)||(t.filtres.date=n),n}),e.k0s()(),e.j41(27,"div",5)(28,"label",6),e.EFF(29,"Plage de dates"),e.k0s(),e.j41(30,"div",12)(31,"input",13),e.mxI("ngModelChange",function(n){return e.DH7(t.filtres.from,n)||(t.filtres.from=n),n}),e.k0s(),e.j41(32,"input",14),e.mxI("ngModelChange",function(n){return e.DH7(t.filtres.to,n)||(t.filtres.to=n),n}),e.k0s()()(),e.j41(33,"div",5)(34,"label",6),e.EFF(35,"Type"),e.k0s(),e.j41(36,"select",15),e.mxI("ngModelChange",function(n){return e.DH7(t.filtres.type,n)||(t.filtres.type=n),n}),e.j41(37,"option",16),e.EFF(38,"-- Tous --"),e.k0s(),e.j41(39,"option",17),e.EFF(40,"Pr\xe9sents"),e.k0s(),e.j41(41,"option",18),e.EFF(42,"Absents"),e.k0s()()(),e.j41(43,"div",19)(44,"div",20)(45,"input",21),e.mxI("ngModelChange",function(n){return e.DH7(t.filtres.includeDetails,n)||(t.filtres.includeDetails=n),n}),e.k0s(),e.j41(46,"label",22),e.EFF(47,"Afficher infos techniques"),e.k0s()()()(),e.j41(48,"div",23)(49,"button",24),e.EFF(50,"\u{1f50d} Appliquer les filtres"),e.k0s(),e.j41(51,"button",25),e.bIt("click",function(){return t.exporter()}),e.EFF(52,"\u{1f4c1} Exporter"),e.k0s()()(),e.j41(53,"div",26)(54,"h5",27),e.EFF(55,"R\xe9sultats"),e.k0s(),e.j41(56,"div",28)(57,"table",29)(58,"thead")(59,"tr")(60,"th"),e.EFF(61,"\xc9tudiant"),e.k0s(),e.j41(62,"th"),e.EFF(63,"Cours"),e.k0s(),e.j41(64,"th"),e.EFF(65,"D\xe9but"),e.k0s(),e.j41(66,"th"),e.EFF(67,"Fin"),e.k0s(),e.j41(68,"th"),e.EFF(69,"Pr\xe9sence"),e.k0s(),e.DNE(70,c,2,0,"th",30)(71,g,2,0,"th",30)(72,h,2,0,"th",30),e.k0s()(),e.j41(73,"tbody"),e.DNE(74,F,14,10,"tr",31)(75,C,3,0,"tr",30),e.k0s()()()()()(),e.nrm(76,"app-footer")),2&s&&(e.R7$(10),e.R50("ngModel",t.filtres.promo),e.R7$(4),e.R50("ngModel",t.filtres.id_groupe_TD),e.R7$(4),e.R50("ngModel",t.filtres.id_groupe_Anglais),e.R7$(4),e.R50("ngModel",t.filtres.email),e.R7$(4),e.R50("ngModel",t.filtres.date),e.R7$(5),e.R50("ngModel",t.filtres.from),e.R7$(),e.R50("ngModel",t.filtres.to),e.R7$(4),e.R50("ngModel",t.filtres.type),e.R7$(9),e.R50("ngModel",t.filtres.includeDetails),e.R7$(25),e.Y8G("ngIf",t.filtres.includeDetails),e.R7$(),e.Y8G("ngIf",t.filtres.includeDetails),e.R7$(),e.Y8G("ngIf",t.filtres.includeDetails),e.R7$(2),e.Y8G("ngForOf",t.resultats),e.R7$(),e.Y8G("ngIf",0===t.resultats.length))},dependencies:[m.l,f.n,d.MD,d.YU,d.Sq,d.bT,l.YN,l.qT,l.xH,l.y7,l.me,l.Zm,l.wz,l.BC,l.cb,l.vS,l.cV],encapsulation:2})}return r})()}}]);