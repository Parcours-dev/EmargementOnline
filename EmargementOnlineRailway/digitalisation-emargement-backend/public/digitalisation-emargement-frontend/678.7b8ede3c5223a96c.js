"use strict";(self.webpackChunkdigitalisation_emargement_frontend=self.webpackChunkdigitalisation_emargement_frontend||[]).push([[678],{4678:(w,l,d)=>{d.r(l),d.d(l,{DashBoardEtudiantComponent:()=>M});var e=d(8457),_=d(7028),f=d(7136),c=d(177),p=d(1626),u=d(4341);const m=(r,s)=>({"text-success":r,"text-danger":s});function g(r,s){1&r&&(e.j41(0,"p",19),e.EFF(1,"\u23f3 Cours en cours"),e.k0s())}function h(r,s){1&r&&(e.j41(0,"p",20),e.EFF(1,"\u2705 Pr\xe9sent"),e.k0s())}function E(r,s){1&r&&(e.j41(0,"p",21),e.EFF(1,"\u274c Absent"),e.k0s())}function b(r,s){if(1&r&&(e.j41(0,"div",13)(1,"div",14)(2,"h5",15),e.EFF(3),e.k0s(),e.j41(4,"p"),e.EFF(5),e.nI1(6,"date"),e.nI1(7,"date"),e.k0s(),e.DNE(8,g,2,0,"p",16)(9,h,2,0,"p",17)(10,E,2,0,"p",18),e.k0s()()),2&r){const t=s.$implicit,n=e.XpG();e.Y8G("ngClass",n.getColorClasse(t)),e.R7$(3),e.JRh(t.nom_cours),e.R7$(2),e.Lme("",e.i5U(6,7,t.date_heure_debut,"shortTime")," - ",e.i5U(7,10,t.date_heure_fin,"shortTime"),""),e.R7$(3),e.Y8G("ngIf",t===n.coursEnCours&&!0!==t.present),e.R7$(),e.Y8G("ngIf",!0===t.present),e.R7$(),e.Y8G("ngIf",!1===t.present&&t!==n.coursEnCours)}}function C(r,s){if(1&r&&(e.j41(0,"option",22),e.EFF(1),e.k0s()),2&r){const t=s.$implicit;e.Y8G("value",t.jour),e.R7$(),e.JRh(t.jour)}}function x(r,s){if(1&r&&(e.j41(0,"div",41),e.EFF(1," \u2705 "),e.j41(2,"strong"),e.EFF(3),e.k0s(),e.EFF(4," pr\xeat \xe0 \xeatre envoy\xe9. "),e.k0s()),2&r){const t=e.XpG(2).$implicit;e.R7$(3),e.JRh(t.fichier.name)}}function F(r,s){1&r&&(e.j41(0,"div",42),e.EFF(1," \u2705 Justificatif envoy\xe9 avec succ\xe8s "),e.k0s())}function v(r,s){1&r&&(e.j41(0,"div",43),e.EFF(1," \u274c Erreur lors de l'envoi du justificatif "),e.k0s())}function D(r,s){if(1&r){const t=e.RV6();e.j41(0,"div",32)(1,"label",33),e.EFF(2,"D\xe9poser un justificatif (PDF ou image) :"),e.k0s(),e.j41(3,"div",34)(4,"input",35),e.bIt("change",function(o){e.eBV(t);const i=e.XpG().$implicit,a=e.XpG(2);return e.Njj(a.onFileSelected(o,i))}),e.k0s()(),e.DNE(5,x,5,1,"div",36),e.j41(6,"div",34)(7,"textarea",37),e.mxI("ngModelChange",function(o){e.eBV(t);const i=e.XpG().$implicit;return e.DH7(i.commentaire,o)||(i.commentaire=o),e.Njj(o)}),e.k0s()(),e.j41(8,"button",38),e.bIt("click",function(){e.eBV(t);const o=e.XpG().$implicit,i=e.XpG(2);return e.Njj(i.deposerJustificatif(o))}),e.EFF(9," \u{1f4e4} Envoyer le justificatif "),e.k0s(),e.DNE(10,F,2,0,"div",39)(11,v,2,0,"div",40),e.k0s()}if(2&r){const t=e.XpG().$implicit;e.R7$(5),e.Y8G("ngIf",t.fichier),e.R7$(2),e.R50("ngModel",t.commentaire),e.R7$(),e.Y8G("disabled",!t.fichier),e.R7$(2),e.Y8G("ngIf",t.depotOk),e.R7$(),e.Y8G("ngIf",t.depotErreur)}}function j(r,s){if(1&r&&(e.j41(0,"li",27)(1,"div",28)(2,"div")(3,"strong"),e.EFF(4),e.k0s(),e.EFF(5," \u2014 "),e.j41(6,"span",29),e.EFF(7),e.k0s(),e.nrm(8,"br"),e.j41(9,"small",29),e.EFF(10),e.nI1(11,"date"),e.nI1(12,"date"),e.k0s()(),e.j41(13,"span",30),e.EFF(14),e.k0s()(),e.DNE(15,D,12,5,"div",31),e.k0s()),2&r){const t=s.$implicit,n=e.XpG(2);e.R7$(4),e.JRh(t.nom_cours),e.R7$(3),e.JRh(t.nom_groupe),e.R7$(3),e.Lme("",e.i5U(11,7,t.date_heure_debut,"shortTime")," - ",e.i5U(12,10,t.date_heure_fin,"shortTime"),""),e.R7$(3),e.Y8G("ngClass",e.l_i(13,m,t.present,!t.present)),e.R7$(),e.SpI(" ",t.present?"\u2705 Pr\xe9sent":"\u274c Absent"," "),e.R7$(),e.Y8G("ngIf",!t.present&&!n.estCoursAvenir(t))}}function O(r,s){if(1&r&&(e.j41(0,"div",23)(1,"h6",24),e.EFF(2),e.k0s(),e.j41(3,"ul",25),e.DNE(4,j,16,16,"li",26),e.k0s()()),2&r){const t=s.$implicit,n=e.XpG();e.Y8G("hidden",n.jourFiltre&&n.jourFiltre!==t.jour),e.R7$(2),e.JRh(t.jour),e.R7$(2),e.Y8G("ngForOf",t.cours)}}let M=(()=>{class r{coursDuJour=[];coursEnCours=null;coursSelectionne=null;statutEmargement=null;historique=[];jourFiltre="";justificatifs=[];headers=null;qrCodeActif=null;BASE_URL="https://emargementonline-production.up.railway.app/api";http=(0,e.WQX)(p.Qq);ngOnInit(){const t=localStorage.getItem("_TOKEN_UTILISATEUR");if(t){const n=JSON.parse(t);this.headers=(new p.Lr).set("Authorization",`Bearer ${n.token}`),this.chargerCours(),this.chargerHistorique(),this.chargerJustificatifs()}else console.warn("\u26a0\ufe0f Aucun token dans le localStorage")}chargerCours(){if(!this.headers)return;const t=(0,c.Yq)(new Date,"yyyy-MM-dd","fr");this.http.get(`${this.BASE_URL}/etudiants/mes-presences?date=${t}`,{headers:this.headers}).subscribe({next:o=>{this.coursDuJour=o,this.detecterCoursEnCours()},error:()=>console.error("\u274c Erreur chargement cours du jour")})}chargerHistorique(){this.headers&&this.http.get(`${this.BASE_URL}/etudiants/mes-presences`,{headers:this.headers}).subscribe({next:n=>{const o={};n.forEach(i=>{const a=new Date(i.date_heure_debut).toLocaleDateString("fr-FR",{weekday:"long"});o[a]||(o[a]=[]),i.commentaire="",i.fichier=null,i.depotOk=!1,o[a].push(i)}),this.historique=Object.entries(o).map(([i,a])=>({jour:i,cours:a}))},error:()=>console.error("\u274c Erreur chargement historique")})}chargerJustificatifs(){this.headers&&this.http.get(`${this.BASE_URL}/etudiants/justificatifs`,{headers:this.headers}).subscribe({next:n=>this.justificatifs=n,error:()=>console.error("\u274c Erreur chargement justificatifs")})}verifierStatutPresence(){this.statutEmargement=this.coursSelectionne?!!this.coursSelectionne.present:null}detecterCoursEnCours(){const t=(new Date).getTime();this.coursEnCours=this.coursDuJour.find(n=>{const o=new Date(n.date_heure_debut).getTime(),i=new Date(n.date_heure_fin).getTime();return t>=o&&t<=i})||null}getColorClasse(t){const n=(new Date).getTime(),o=new Date(t.date_heure_debut).getTime(),i=new Date(t.date_heure_fin).getTime();return!0===t.present?"border-success":!1===t.present&&n>i?"border-danger":null===t.present&&n<o?"border-info":n>=o&&n<=i&&!0!==t.present?"border-warning":"border-secondary"}estCoursAvenir(t){return(new Date).getTime()<new Date(t.date_heure_debut).getTime()&&null===t.present}onFileSelected(t,n){n.fichier=t.target.files[0],n.depotOk=!1,n.depotErreur=!1}deposerJustificatif(t){if(!this.headers)return;if(!t.fichier)return void alert("Veuillez s\xe9lectionner un fichier.");if(!t.id_groupe||isNaN(t.id_groupe))return void alert("Le groupe du cours est manquant ou invalide.");const n=new FormData;n.append("id_cours",t.id_cours),n.append("id_groupe",t.id_groupe.toString()),n.append("date_heure_debut",t.date_heure_debut),n.append("fichier",t.fichier),n.append("commentaire",t.commentaire||""),this.http.post(`${this.BASE_URL}/etudiants/justificatifs`,n,{headers:this.headers}).subscribe({next:()=>{t.commentaire="",t.fichier=null,t.depotOk=!0,t.depotErreur=!1,setTimeout(()=>{t.depotOk=!1},5e3),this.chargerHistorique()},error:o=>{console.error("\u274c Erreur lors de l\u2019envoi du justificatif",o),t.depotErreur=!0,setTimeout(()=>{t.depotErreur=!1},5e3)}})}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=e.VBU({type:r,selectors:[["app-dashboard-etudiant"]],decls:20,vars:4,consts:[[1,"grayed-background","main-content","py-4"],[1,"container"],[1,"row","g-4"],[1,"col-lg-4","col-md-6"],[1,"cours-du-jour"],["class","card mt-3 text-center",3,"ngClass",4,"ngFor","ngForOf"],[1,"col-lg-5","col-md-6"],[1,"historique"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"form-select","w-auto",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"hidden",4,"ngFor","ngForOf"],[1,"card","mt-3","text-center",3,"ngClass"],[1,"card-body"],[1,"card-title"],["class","text-warning fw-bold",4,"ngIf"],["class","text-success fw-bold",4,"ngIf"],["class","text-danger fw-bold",4,"ngIf"],[1,"text-warning","fw-bold"],[1,"text-success","fw-bold"],[1,"text-danger","fw-bold"],[3,"value"],[3,"hidden"],[1,"text-capitalize","fw-semibold"],[1,"list-group","mb-3"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],[1,"d-flex","flex-column","flex-md-row","justify-content-between","align-items-md-center"],[1,"text-muted"],[1,"mt-2","mt-md-0","fw-bold","fs-5",3,"ngClass"],["class","mt-3 p-3 border rounded bg-light",4,"ngIf"],[1,"mt-3","p-3","border","rounded","bg-light"],[1,"form-label","fw-semibold"],[1,"mb-2"],["type","file","accept",".pdf,image/*",1,"form-control",3,"change"],["class","text-success mb-2",4,"ngIf"],["placeholder","Ex : certificat m\xe9dical, convocation...","rows","2",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-primary","btn-sm",3,"click","disabled"],["class","justif-success-badge",4,"ngIf"],["class","alert alert-danger mt-2 p-2",4,"ngIf"],[1,"text-success","mb-2"],[1,"justif-success-badge"],[1,"alert","alert-danger","mt-2","p-2"]],template:function(n,o){1&n&&(e.nrm(0,"app-header"),e.j41(1,"main",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"section",4)(6,"h5"),e.EFF(7,"Cours du jour"),e.k0s(),e.DNE(8,b,11,13,"div",5),e.k0s()(),e.j41(9,"div",6)(10,"section",7)(11,"div",8)(12,"h5"),e.EFF(13,"Historique de pr\xe9sence"),e.k0s(),e.j41(14,"select",9),e.mxI("ngModelChange",function(a){return e.DH7(o.jourFiltre,a)||(o.jourFiltre=a),a}),e.j41(15,"option",10),e.EFF(16,"-- Filtrer par jour --"),e.k0s(),e.DNE(17,C,2,2,"option",11),e.k0s()(),e.DNE(18,O,5,3,"div",12),e.k0s()()()()(),e.nrm(19,"app-footer")),2&n&&(e.R7$(8),e.Y8G("ngForOf",o.coursDuJour),e.R7$(6),e.R50("ngModel",o.jourFiltre),e.R7$(3),e.Y8G("ngForOf",o.historique),e.R7$(),e.Y8G("ngForOf",o.historique))},dependencies:[_.l,f.n,c.MD,c.YU,c.Sq,c.bT,c.vh,u.YN,u.xH,u.y7,u.me,u.wz,u.BC,u.vS],styles:[".main-content[_ngcontent-%COMP%]{padding-top:20px;padding-bottom:40px;background-color:#f5f7fa}.dashboard-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 3fr;gap:2rem;padding-top:1rem}.cours-du-jour[_ngcontent-%COMP%]{background-color:#fff;padding:1.5rem;border-radius:16px;box-shadow:0 4px 12px #0000000d;position:sticky;top:20px;height:fit-content}.historique[_ngcontent-%COMP%]{background-color:#fff;padding:1.5rem;border-radius:16px;box-shadow:0 4px 12px #0000000d}.card[_ngcontent-%COMP%]{border-radius:16px;box-shadow:0 4px 12px #0000000d;transition:transform .2s ease}.card[_ngcontent-%COMP%]:hover{transform:scale(1.01)}.card-body[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:600;color:#333}.text-success[_ngcontent-%COMP%]{color:#28a745!important;font-weight:700}.text-danger[_ngcontent-%COMP%]{color:#dc3545!important;font-weight:700}.text-warning[_ngcontent-%COMP%]{color:#ffc107!important;font-weight:700}.form-select[_ngcontent-%COMP%]{border-radius:12px;padding:8px 12px;font-size:.95rem}.list-group-item[_ngcontent-%COMP%]{border:none;border-radius:8px;background-color:#f9f9f9;margin-bottom:6px;padding:10px 16px}.border-success[_ngcontent-%COMP%]{border:2px solid #28a745!important}.border-danger[_ngcontent-%COMP%]{border:2px solid #dc3545!important}.border-warning[_ngcontent-%COMP%]{border:2px solid #ffc107!important}.border-secondary[_ngcontent-%COMP%]{border:2px solid #6c757d!important}label[_ngcontent-%COMP%]{font-weight:500}@media (max-width: 768px){.dashboard-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.card-body[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:1rem}.cours-du-jour[_ngcontent-%COMP%], .historique[_ngcontent-%COMP%]{padding:1rem;box-shadow:none;border-radius:12px}}.card-body[_ngcontent-%COMP%]   select.form-select[_ngcontent-%COMP%]{min-width:180px;font-size:.95rem}.border-upcoming[_ngcontent-%COMP%]{border:2px dashed #6c757d!important}"]})}return r})()}}]);