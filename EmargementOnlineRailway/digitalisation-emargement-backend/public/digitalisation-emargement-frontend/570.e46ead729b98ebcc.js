"use strict";(self.webpackChunkdigitalisation_emargement_frontend=self.webpackChunkdigitalisation_emargement_frontend||[]).push([[570],{2570:(R,p,i)=>{i.r(p),i.d(p,{DashBoardProfesseurComponent:()=>F});var e=i(8457),l=i(177),c=i(1626),b=i(7028),g=i(7136);const h=r=>({"border border-warning bg-light":r}),C=(r,m)=>({"text-success":r,"text-danger":m});function v(r,m){if(1&r){const t=e.RV6();e.j41(0,"button",15),e.bIt("click",function(){e.eBV(t);const o=e.XpG().$implicit,a=e.XpG(2);return e.Njj(a.lancerGenerationQr(o))}),e.EFF(1," \u{1f680} G\xe9n\xe9rer QR Code "),e.k0s()}}function D(r,m){if(1&r){const t=e.RV6();e.j41(0,"button",22),e.bIt("click",function(){e.eBV(t);const o=e.XpG().$implicit,a=e.XpG(4);return e.Njj(a.validerPresenceManuelle(o.email))}),e.EFF(1," Valider "),e.k0s()}}function s(r,m){if(1&r&&(e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td")(8,"span",20),e.EFF(9),e.k0s()(),e.j41(10,"td"),e.DNE(11,D,2,0,"button",21),e.k0s()()),2&r){const t=m.$implicit;e.R7$(2),e.JRh(t.nom),e.R7$(2),e.JRh(t.prenom),e.R7$(2),e.JRh(t.email),e.R7$(2),e.Y8G("ngClass",e.l_i(6,C,t.present,!t.present)),e.R7$(),e.SpI(" ",t.present?"Pr\xe9sent":"Absent"," "),e.R7$(2),e.Y8G("ngIf",!t.present)}}function E(r,m){if(1&r&&(e.j41(0,"div",16)(1,"h6"),e.EFF(2,"\u{1f465} \xc9tudiants attendus"),e.k0s(),e.j41(3,"table",17)(4,"thead",18)(5,"tr")(6,"th"),e.EFF(7,"Nom"),e.k0s(),e.j41(8,"th"),e.EFF(9,"Pr\xe9nom"),e.k0s(),e.j41(10,"th"),e.EFF(11,"Email"),e.k0s(),e.j41(12,"th"),e.EFF(13,"Statut"),e.k0s(),e.j41(14,"th"),e.EFF(15,"Action"),e.k0s()()(),e.j41(16,"tbody"),e.DNE(17,s,12,9,"tr",19),e.k0s()()()),2&r){const t=e.XpG(3);e.R7$(17),e.Y8G("ngForOf",t.etudiantsCours)}}function _(r,m){if(1&r&&(e.j41(0,"div",8)(1,"div",9)(2,"div",10)(3,"div")(4,"h6",11),e.EFF(5),e.k0s(),e.j41(6,"small"),e.EFF(7),e.k0s(),e.nrm(8,"br"),e.j41(9,"small",12),e.EFF(10),e.nI1(11,"date"),e.nI1(12,"date"),e.k0s()(),e.DNE(13,v,2,0,"button",13),e.k0s(),e.DNE(14,E,18,1,"div",14),e.k0s()()),2&r){const t=m.$implicit,n=e.XpG(2);e.Y8G("ngClass",e.eq3(13,h,t===n.coursEnCours)),e.R7$(5),e.JRh(t.nom_cours),e.R7$(2),e.JRh(t.nom_groupe),e.R7$(3),e.Lme(" ",e.i5U(11,7,t.date_heure_debut,"shortTime")," - ",t.date_heure_fin?e.i5U(12,10,t.date_heure_fin,"shortTime"):"\u2014"," "),e.R7$(3),e.Y8G("ngIf",t===n.coursEnCours),e.R7$(),e.Y8G("ngIf",t===n.coursEnCours&&n.etudiantsCours.length>0)}}function f(r,m){if(1&r&&(e.qex(0),e.DNE(1,_,15,15,"div",7),e.bVm()),2&r){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.coursDuJour)}}function u(r,m){1&r&&(e.j41(0,"p",12),e.EFF(1,"Aucun cours pr\xe9vu aujourd'hui."),e.k0s())}let F=(()=>{class r{coursDuJour=[];coursEnCours=null;etudiantsCours=[];refreshInterval;BASE_URL="https://emargementonline-production.up.railway.app/api";http=(0,e.WQX)(c.Qq);ngOnInit(){const t=localStorage.getItem("_TOKEN_UTILISATEUR");if(!t)return void console.error("\u274c Aucun token trouv\xe9 dans le localStorage");const n=JSON.parse(t),o=this.decodeToken(n.token);if(!o?.id)return void console.error("\u274c Impossible de d\xe9terminer l\u2019ID du professeur");const a=o.id,d=(new c.Lr).set("Authorization",`Bearer ${n.token}`);this.chargerEmploiDuTemps(a,d)}decodeToken(t){try{const n=t.split(".")[1];return JSON.parse(atob(n))}catch(n){return console.error("Erreur d\xe9codage token :",n),null}}chargerEmploiDuTemps(t,n){this.http.get(`${this.BASE_URL}/enseignants/${t}/emplois`,{headers:n}).subscribe({next:o=>{const a=(new Date).toISOString().split("T")[0];this.coursDuJour=o.filter(d=>new Date(d.date_heure_debut).toISOString().startsWith(a)),this.detecterCoursEnCours(n)},error:()=>{console.error("\u274c Erreur lors du chargement de l'emploi du temps du jour")}})}detecterCoursEnCours(t){const n=Date.now();this.coursEnCours=this.coursDuJour.find(o=>{const a=new Date(o.date_heure_debut).getTime(),d=new Date(o.date_heure_fin).getTime();return n>=a&&n<=d})||null,this.coursEnCours?(this.chargerEtudiantsCoursEnCours(t),this.refreshInterval=setInterval(()=>{this.chargerEtudiantsCoursEnCours(t)},3e3)):this.refreshInterval&&clearInterval(this.refreshInterval)}chargerEtudiantsCoursEnCours(t){if(!this.coursEnCours)return;const{id_cours:n,id_groupe:o,date_heure_debut:a}=this.coursEnCours,d=new URLSearchParams({id_cours:n,id_groupe:o,date_heure_debut:a});this.http.get(`${this.BASE_URL}/presences/controle?${d.toString()}`,{headers:t}).subscribe({next:I=>{this.etudiantsCours=I},error:()=>{console.error("\u274c Erreur lors du chargement des \xe9tudiants du cours")}})}validerPresenceManuelle(t){const n=JSON.parse(localStorage.getItem("_TOKEN_UTILISATEUR")).token,o=(new c.Lr).set("Authorization",`Bearer ${n}`);this.http.patch(`${this.BASE_URL}/presences/valider`,{email:t,id_cours:this.coursEnCours.id_cours,id_groupe:this.coursEnCours.id_groupe,date_heure_debut:this.coursEnCours.date_heure_debut},{headers:o}).subscribe({next:d=>{alert(d.message||"Pr\xe9sence valid\xe9e"),this.chargerEtudiantsCoursEnCours(o)},error:()=>alert("\u274c Erreur lors de la validation")})}lancerGenerationQr(t){const n=t.id_cours,o=t.id_groupe,a=t.id_professeur,d=new Date(t.date_heure_debut),I=new Date(d.getTime()-72e5),T=(0,l.Yq)(I,"yyyy-MM-dd HH:mm:ss","fr-FR"),U=encodeURIComponent(`${n}-${o}-${a}-${T}`);window.open(`https://emargementonline-production.up.railway.app/generation-qr?creneau_id=${U}`,"_blank","width=420,height=500")}ngOnDestroy(){this.refreshInterval&&clearInterval(this.refreshInterval)}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=e.VBU({type:r,selectors:[["app-dashboard-professeur"]],decls:11,vars:2,consts:[["aucunCours",""],[1,"grayed-background","main-content"],[1,"container","py-4"],[1,"card"],[1,"card-body"],[1,"mb-3"],[4,"ngIf","ngIfElse"],["class","card shadow-sm mb-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"card","shadow-sm","mb-2",3,"ngClass"],[1,"card-body","p-2"],[1,"d-flex","justify-content-between","align-items-center"],[1,"mb-1"],[1,"text-muted"],["class","btn btn-sm btn-outline-success ms-3",3,"click",4,"ngIf"],["class","mt-3",4,"ngIf"],[1,"btn","btn-sm","btn-outline-success","ms-3",3,"click"],[1,"mt-3"],[1,"table","table-sm","table-bordered","mt-2"],[1,"table-light"],[4,"ngFor","ngForOf"],[3,"ngClass"],["class","btn btn-sm btn-outline-primary",3,"click",4,"ngIf"],[1,"btn","btn-sm","btn-outline-primary",3,"click"]],template:function(n,o){if(1&n&&(e.nrm(0,"app-header"),e.j41(1,"main",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h5",5),e.EFF(6,"Cours \xe0 venir aujourd'hui"),e.k0s(),e.DNE(7,f,2,1,"ng-container",6)(8,u,2,0,"ng-template",null,0,e.C5r),e.k0s()()()(),e.nrm(10,"app-footer")),2&n){const a=e.sdS(9);e.R7$(7),e.Y8G("ngIf",o.coursDuJour.length>0)("ngIfElse",a)}},dependencies:[b.l,g.n,l.MD,l.YU,l.Sq,l.bT,l.vh],encapsulation:2})}return r})()},7028:(R,p,i)=>{i.d(p,{l:()=>D});var e=i(8457),l=i(3242),c=i(7147);function b(s,E){if(1&s&&(e.j41(0,"a",2),e.EFF(1),e.k0s()),2&s){const _=e.XpG();e.R7$(),e.SpI("Bonjour ",_.nomUtilisateur,"")}}function g(s,E){1&s&&(e.j41(0,"a",4),e.EFF(1,"Tableau de bord Etudiant"),e.k0s())}function h(s,E){1&s&&(e.j41(0,"a",4),e.EFF(1,"Tableau de bord CFA"),e.k0s(),e.j41(2,"a",4),e.EFF(3,"Rapport des absences"),e.k0s())}function C(s,E){1&s&&(e.j41(0,"a",4),e.EFF(1,"Tableau de bord Professeur"),e.k0s())}function v(s,E){if(1&s){const _=e.RV6();e.j41(0,"button",6),e.bIt("click",function(){e.eBV(_);const u=e.XpG();return e.Njj(u.deconnecterUtilisateur())}),e.EFF(1," D\xe9connexion "),e.k0s()}}let D=(()=>{class s{router=(0,e.WQX)(l.Ix);doitAfficherHeaderEtudiant=!1;doitAfficherHeaderProfesseur=!1;doitAfficherHeaderCfa=!1;estUtilisateurConnecte=!1;nomUtilisateur="";ROLE_PROFESSEUR="professeur";ROLE_ETUDIANT="etudiant";ROLE_CFA="cfa";ngOnInit(){this.affichageHeader()}deconnecterUtilisateur(){typeof window<"u"&&(localStorage.removeItem("_TOKEN_UTILISATEUR"),localStorage.removeItem("_INFOS_UTILISATEUR"),localStorage.clear()),this.router.navigateByUrl(`${c.ZU}`)}redirigeVerPageDashboardEtudiant(){this.router.navigateByUrl(`${c.gN}`)}redirigeVerPageDashboardCfa(){this.router.navigateByUrl(`${c.Gy}`)}redirigeVerPageDashboardProfesseur(){this.router.navigateByUrl(`${c.Cy}`)}affichageHeader(){if(typeof window>"u")return;const _=localStorage.getItem("_INFOS_UTILISATEUR"),f=localStorage.getItem("_TOKEN_UTILISATEUR");if(!_||!f)return void(this.estUtilisateurConnecte=!1);const u=JSON.parse(_),F=JSON.parse(f);this.nomUtilisateur=u.nom+" "+u.prenom,u.role===this.ROLE_ETUDIANT&&(this.doitAfficherHeaderEtudiant=!0),u.role===this.ROLE_CFA&&(this.doitAfficherHeaderCfa=!0),u.role===this.ROLE_PROFESSEUR&&(this.doitAfficherHeaderProfesseur=!0),null!==F?.token&&(this.estUtilisateurConnecte=!0)}static \u0275fac=function(f){return new(f||s)};static \u0275cmp=e.VBU({type:s,selectors:[["app-header"]],decls:8,vars:5,consts:[[1,"navbar","navbar-expand-lg","navbar-dark"],[1,"container-fluid"],[1,"navbar-brand"],[1,"d-flex","justify-content-center","flex-grow-1"],[1,"navbar-brand","navbar-link-small"],[1,"btn","btn-white","ms-auto","deconnexion-btn"],[1,"btn","btn-white","ms-auto","deconnexion-btn",3,"click"]],template:function(f,u){1&f&&(e.j41(0,"nav",0)(1,"div",1),e.DNE(2,b,2,1,"a",2),e.j41(3,"div",3),e.DNE(4,g,2,0,"a",4)(5,h,4,0)(6,C,2,0,"a",4),e.k0s(),e.DNE(7,v,2,0,"button",5),e.k0s()()),2&f&&(e.R7$(2),e.vxM(u.estUtilisateurConnecte?2:-1),e.R7$(2),e.vxM(u.doitAfficherHeaderEtudiant?4:-1),e.R7$(),e.vxM(u.doitAfficherHeaderCfa?5:-1),e.R7$(),e.vxM(u.doitAfficherHeaderProfesseur?6:-1),e.R7$(),e.vxM(u.estUtilisateurConnecte?7:-1))},encapsulation:2})}return s})()},7136:(R,p,i)=>{i.d(p,{n:()=>l});var e=i(8457);let l=(()=>{class c{static \u0275fac=function(h){return new(h||c)};static \u0275cmp=e.VBU({type:c,selectors:[["app-footer"]],decls:5,vars:0,consts:[[1,"container"],[1,"footer-text"]],template:function(h,C){1&h&&(e.j41(0,"footer")(1,"div",0)(2,"div",1)(3,"p"),e.EFF(4,"\xa9 Digitalisation de l'\xe9margement"),e.k0s()()()())},encapsulation:2})}return c})()}}]);