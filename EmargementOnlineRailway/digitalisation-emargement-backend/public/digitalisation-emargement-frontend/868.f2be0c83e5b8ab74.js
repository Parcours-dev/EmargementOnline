"use strict";(self.webpackChunkdigitalisation_emargement_frontend=self.webpackChunkdigitalisation_emargement_frontend||[]).push([[868],{868:(S,m,r)=>{r.r(m),r.d(m,{ScanQrComponent:()=>f});var c=r(3242),g=r(1626),_=r(177),e=r(8457);const u=(t,o,n)=>({success:t,error:o,loading:n});function l(t,o){1&t&&(e.j41(0,"span"),e.EFF(1,"\u2705"),e.k0s())}function p(t,o){1&t&&(e.j41(0,"span"),e.EFF(1,"\u274c"),e.k0s())}function d(t,o){1&t&&(e.j41(0,"span"),e.EFF(1,"\u23f3"),e.k0s())}function h(t,o){if(1&t&&(e.j41(0,"div",2)(1,"div",3),e.DNE(2,l,2,0,"span",4)(3,p,2,0,"span",4)(4,d,2,0,"span",4),e.k0s(),e.j41(5,"h2"),e.EFF(6),e.k0s()()),2&t){const n=e.XpG();e.Y8G("ngClass",e.sMw(5,u,n.isSuccess(),n.isError(),n.isLoading())),e.R7$(2),e.Y8G("ngIf",n.isSuccess()),e.R7$(),e.Y8G("ngIf",n.isError()),e.R7$(),e.Y8G("ngIf",n.isLoading()),e.R7$(2),e.JRh(n.message)}}let f=(()=>{class t{route;router;http;BASE_URL="https://emargementonline-production.up.railway.app/api";message="\u23f3 Traitement en cours...";constructor(n,s,a){this.route=n,this.router=s,this.http=a}ngOnInit(){const n=this.route.snapshot.paramMap.get("token");if(n)return localStorage.getItem("_TOKEN_UTILISATEUR")?void this.enregistrerPresence(n):(localStorage.setItem("_SCAN_TOKEN",n),void this.router.navigate(["/login"]));this.message="\u274c QR Code invalide."}enregistrerPresence(n){const s=localStorage.getItem("_TOKEN_UTILISATEUR");if(!s)return void(this.message="\u274c Utilisateur non authentifi\xe9.");const a=JSON.parse(s).token,E=(new g.Lr).set("Authorization",`Bearer ${a}`),C=window.navigator.userAgent+"_"+window.navigator.platform;this.http.patch(`${this.BASE_URL}/scan/${n}`,{empreinte_device:C},{headers:E}).subscribe({next:i=>{this.message=i.message||"\u2705 Pr\xe9sence enregistr\xe9e !"},error:i=>{console.error(i),this.message=i?.error?.message||"\u274c Erreur pendant l\u2019enregistrement de pr\xe9sence."}})}isSuccess(){return this.message.includes("\u2705")}isError(){return this.message.includes("\u274c")}isLoading(){return this.message.includes("\u23f3")}static \u0275fac=function(s){return new(s||t)(e.rXU(c.nX),e.rXU(c.Ix),e.rXU(g.Qq))};static \u0275cmp=e.VBU({type:t,selectors:[["app-scan-qr"]],decls:2,vars:1,consts:[[1,"scan-container"],[3,"ngClass",4,"ngIf"],[3,"ngClass"],[1,"icon"],[4,"ngIf"]],template:function(s,a){1&s&&(e.j41(0,"div",0),e.DNE(1,h,7,9,"div",1),e.k0s()),2&s&&(e.R7$(),e.Y8G("ngIf",a.message))},dependencies:[_.MD,_.YU,_.bT,g.q1,c.iI],styles:[".scan-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:80vh;text-align:center;padding:2rem}.icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem}.success[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:green}.error[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:red}.loading[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#555}"]})}return t})()}}]);