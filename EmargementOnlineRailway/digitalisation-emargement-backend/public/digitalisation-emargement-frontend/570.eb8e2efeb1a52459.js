"use strict";(self.webpackChunkdigitalisation_emargement_frontend=self.webpackChunkdigitalisation_emargement_frontend||[]).push([[570],{2570:(D,m,s)=>{s.r(m),s.d(m,{DashBoardProfesseurComponent:()=>v});var e=s(8457),_=s(177),c=s(1626),C=s(7028),h=s(7136);const E=r=>({"border border-warning bg-light":r}),b=(r,p)=>({"text-success":r,"text-danger":p});function F(r,p){if(1&r){const t=e.RV6();e.j41(0,"button",15),e.bIt("click",function(){e.eBV(t);const o=e.XpG().$implicit,i=e.XpG(2);return e.Njj(i.lancerGenerationQr(o))}),e.EFF(1," \u{1f680} G\xe9n\xe9rer QR Code "),e.k0s()}}function R(r,p){if(1&r){const t=e.RV6();e.j41(0,"button",22),e.bIt("click",function(){e.eBV(t);const o=e.XpG().$implicit,i=e.XpG(4);return e.Njj(i.validerPresenceManuelle(o.email))}),e.EFF(1," Valider "),e.k0s()}}function a(r,p){if(1&r&&(e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td")(8,"span",20),e.EFF(9),e.k0s()(),e.j41(10,"td"),e.DNE(11,R,2,0,"button",21),e.k0s()()),2&r){const t=p.$implicit;e.R7$(2),e.JRh(t.nom),e.R7$(2),e.JRh(t.prenom),e.R7$(2),e.JRh(t.email),e.R7$(2),e.Y8G("ngClass",e.l_i(6,b,t.present,!t.present)),e.R7$(),e.SpI(" ",t.present?"Pr\xe9sent":"Absent"," "),e.R7$(2),e.Y8G("ngIf",!t.present)}}function g(r,p){if(1&r&&(e.j41(0,"div",16)(1,"h6"),e.EFF(2,"\u{1f465} \xc9tudiants attendus"),e.k0s(),e.j41(3,"table",17)(4,"thead",18)(5,"tr")(6,"th"),e.EFF(7,"Nom"),e.k0s(),e.j41(8,"th"),e.EFF(9,"Pr\xe9nom"),e.k0s(),e.j41(10,"th"),e.EFF(11,"Email"),e.k0s(),e.j41(12,"th"),e.EFF(13,"Statut"),e.k0s(),e.j41(14,"th"),e.EFF(15,"Action"),e.k0s()()(),e.j41(16,"tbody"),e.DNE(17,a,12,9,"tr",19),e.k0s()()()),2&r){const t=e.XpG(3);e.R7$(17),e.Y8G("ngForOf",t.etudiantsCours)}}function l(r,p){if(1&r&&(e.j41(0,"div",8)(1,"div",9)(2,"div",10)(3,"div")(4,"h6",11),e.EFF(5),e.k0s(),e.j41(6,"small"),e.EFF(7),e.k0s(),e.nrm(8,"br"),e.j41(9,"small",12),e.EFF(10),e.nI1(11,"date"),e.nI1(12,"date"),e.k0s()(),e.DNE(13,F,2,0,"button",13),e.k0s(),e.DNE(14,g,18,1,"div",14),e.k0s()()),2&r){const t=p.$implicit,n=e.XpG(2);e.Y8G("ngClass",e.eq3(13,E,t===n.coursEnCours)),e.R7$(5),e.JRh(t.nom_cours),e.R7$(2),e.JRh(t.nom_groupe),e.R7$(3),e.Lme(" ",e.i5U(11,7,t.date_heure_debut,"shortTime")," - ",t.date_heure_fin?e.i5U(12,10,t.date_heure_fin,"shortTime"):"\u2014"," "),e.R7$(3),e.Y8G("ngIf",t===n.coursEnCours),e.R7$(),e.Y8G("ngIf",t===n.coursEnCours&&n.etudiantsCours.length>0)}}function f(r,p){if(1&r&&(e.qex(0),e.DNE(1,l,15,15,"div",7),e.bVm()),2&r){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.coursDuJour)}}function u(r,p){1&r&&(e.j41(0,"p",12),e.EFF(1,"Aucun cours pr\xe9vu aujourd'hui."),e.k0s())}let v=(()=>{class r{coursDuJour=[];coursEnCours=null;etudiantsCours=[];intervalId;BASE_URL="https://emargementonline-production.up.railway.app/api";http=(0,e.WQX)(c.Qq);ngOnInit(){const t=localStorage.getItem("_TOKEN_UTILISATEUR");if(!t)return void console.error("\u274c Aucun token trouv\xe9 dans le localStorage");const n=JSON.parse(t),o=this.decodeToken(n.token);if(!o?.id)return void console.error("\u274c Impossible de d\xe9terminer l\u2019ID du professeur");const i=o.id,d=(new c.Lr).set("Authorization",`Bearer ${n.token}`);this.chargerEmploiDuTemps(i,d),this.intervalId=setInterval(()=>{this.coursEnCours&&this.chargerEtudiantsCoursEnCours(d)},1e4)}ngOnDestroy(){this.intervalId&&clearInterval(this.intervalId)}decodeToken(t){try{const n=t.split(".")[1];return JSON.parse(atob(n))}catch(n){return console.error("Erreur d\xe9codage token :",n),null}}chargerEmploiDuTemps(t,n){this.http.get(`${this.BASE_URL}/enseignants/${t}/emplois`,{headers:n}).subscribe({next:o=>{const i=(new Date).toISOString().split("T")[0];this.coursDuJour=o.filter(d=>new Date(d.date_heure_debut).toISOString().startsWith(i)),this.detecterCoursEnCours(n)},error:()=>{console.error("\u274c Erreur lors du chargement de l'emploi du temps du jour")}})}detecterCoursEnCours(t){const n=Date.now();this.coursEnCours=this.coursDuJour.find(o=>{const i=new Date(o.date_heure_debut).getTime(),d=new Date(o.date_heure_fin).getTime();return n>=i&&n<=d})||null,this.coursEnCours&&this.chargerEtudiantsCoursEnCours(t)}chargerEtudiantsCoursEnCours(t){if(!this.coursEnCours)return;const{id_cours:n,id_groupe:o,date_heure_debut:i}=this.coursEnCours,d=new URLSearchParams({id_cours:n,id_groupe:o,date_heure_debut:i});this.http.get(`${this.BASE_URL}/presences/controle?${d.toString()}`,{headers:t}).subscribe({next:I=>{this.etudiantsCours=I},error:()=>{console.error("\u274c Erreur lors du chargement des \xe9tudiants du cours")}})}validerPresenceManuelle(t){const n=JSON.parse(localStorage.getItem("_TOKEN_UTILISATEUR")).token,o=(new c.Lr).set("Authorization",`Bearer ${n}`);this.http.patch(`${this.BASE_URL}/presences/valider`,{email:t,id_cours:this.coursEnCours.id_cours,id_groupe:this.coursEnCours.id_groupe,date_heure_debut:this.coursEnCours.date_heure_debut},{headers:o}).subscribe({next:d=>{alert(d.message||"Pr\xe9sence valid\xe9e"),this.chargerEtudiantsCoursEnCours(o)},error:()=>alert("\u274c Erreur lors de la validation")})}lancerGenerationQr(t){const{id_cours:n,id_groupe:o,id_professeur:i,date_heure_debut:d}=t,I=new Date(d).toISOString().slice(0,19).replace("T"," "),U=encodeURIComponent(`${n}-${o}-${i}-${I}`);window.open(`https://emargementonline-production.up.railway.app/generation-qr?creneau_id=${U}`,"_blank","width=420,height=500")}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=e.VBU({type:r,selectors:[["app-dashboard-professeur"]],decls:11,vars:2,consts:[["aucunCours",""],[1,"grayed-background","main-content"],[1,"container","py-4"],[1,"card"],[1,"card-body"],[1,"mb-3"],[4,"ngIf","ngIfElse"],["class","card shadow-sm mb-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"card","shadow-sm","mb-2",3,"ngClass"],[1,"card-body","p-2"],[1,"d-flex","justify-content-between","align-items-center"],[1,"mb-1"],[1,"text-muted"],["class","btn btn-sm btn-outline-success ms-3",3,"click",4,"ngIf"],["class","mt-3",4,"ngIf"],[1,"btn","btn-sm","btn-outline-success","ms-3",3,"click"],[1,"mt-3"],[1,"table","table-sm","table-bordered","mt-2"],[1,"table-light"],[4,"ngFor","ngForOf"],[3,"ngClass"],["class","btn btn-sm btn-outline-primary",3,"click",4,"ngIf"],[1,"btn","btn-sm","btn-outline-primary",3,"click"]],template:function(n,o){if(1&n&&(e.nrm(0,"app-header"),e.j41(1,"main",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h5",5),e.EFF(6,"Cours \xe0 venir aujourd'hui"),e.k0s(),e.DNE(7,f,2,1,"ng-container",6)(8,u,2,0,"ng-template",null,0,e.C5r),e.k0s()()()(),e.nrm(10,"app-footer")),2&n){const i=e.sdS(9);e.R7$(7),e.Y8G("ngIf",o.coursDuJour.length>0)("ngIfElse",i)}},dependencies:[C.l,h.n,_.MD,_.YU,_.Sq,_.bT,_.vh],encapsulation:2})}return r})()},7028:(D,m,s)=>{s.d(m,{l:()=>R});var e=s(8457),_=s(3242),c=s(7147);function C(a,g){if(1&a&&(e.j41(0,"a",2),e.EFF(1),e.k0s()),2&a){const l=e.XpG();e.R7$(),e.SpI("Bonjour ",l.nomUtilisateur,"")}}function h(a,g){1&a&&(e.j41(0,"a",4),e.EFF(1,"Tableau de bord Etudiant"),e.k0s())}function E(a,g){1&a&&(e.j41(0,"a",4),e.EFF(1,"Tableau de bord CFA"),e.k0s(),e.j41(2,"a",4),e.EFF(3,"Rapport des absences"),e.k0s())}function b(a,g){1&a&&(e.j41(0,"a",4),e.EFF(1,"Tableau de bord Professeur"),e.k0s())}function F(a,g){if(1&a){const l=e.RV6();e.j41(0,"button",6),e.bIt("click",function(){e.eBV(l);const u=e.XpG();return e.Njj(u.deconnecterUtilisateur())}),e.EFF(1," D\xe9connexion "),e.k0s()}}let R=(()=>{class a{router=(0,e.WQX)(_.Ix);doitAfficherHeaderEtudiant=!1;doitAfficherHeaderProfesseur=!1;doitAfficherHeaderCfa=!1;estUtilisateurConnecte=!1;nomUtilisateur="";ROLE_PROFESSEUR="professeur";ROLE_ETUDIANT="etudiant";ROLE_CFA="cfa";ngOnInit(){this.affichageHeader()}deconnecterUtilisateur(){typeof window<"u"&&(localStorage.removeItem("_TOKEN_UTILISATEUR"),localStorage.removeItem("_INFOS_UTILISATEUR"),localStorage.clear()),this.router.navigateByUrl(`${c.ZU}`)}affichageHeader(){if(typeof window>"u")return;const l=localStorage.getItem("_INFOS_UTILISATEUR"),f=localStorage.getItem("_TOKEN_UTILISATEUR");if(!l||!f)return void(this.estUtilisateurConnecte=!1);const u=JSON.parse(l),v=JSON.parse(f);this.nomUtilisateur=u.nom+" "+u.prenom,u.role===this.ROLE_ETUDIANT&&(this.doitAfficherHeaderEtudiant=!0),u.role===this.ROLE_CFA&&(this.doitAfficherHeaderCfa=!0),u.role===this.ROLE_PROFESSEUR&&(this.doitAfficherHeaderProfesseur=!0),null!==v?.token&&(this.estUtilisateurConnecte=!0)}static \u0275fac=function(f){return new(f||a)};static \u0275cmp=e.VBU({type:a,selectors:[["app-header"]],decls:8,vars:5,consts:[[1,"navbar","navbar-expand-lg","navbar-dark"],[1,"container-fluid"],[1,"navbar-brand"],[1,"d-flex","justify-content-center","flex-grow-1"],[1,"navbar-brand","navbar-link-small"],[1,"btn","btn-white","ms-auto","deconnexion-btn"],[1,"btn","btn-white","ms-auto","deconnexion-btn",3,"click"]],template:function(f,u){1&f&&(e.j41(0,"nav",0)(1,"div",1),e.DNE(2,C,2,1,"a",2),e.j41(3,"div",3),e.DNE(4,h,2,0,"a",4)(5,E,4,0)(6,b,2,0,"a",4),e.k0s(),e.DNE(7,F,2,0,"button",5),e.k0s()()),2&f&&(e.R7$(2),e.vxM(u.estUtilisateurConnecte?2:-1),e.R7$(2),e.vxM(u.doitAfficherHeaderEtudiant?4:-1),e.R7$(),e.vxM(u.doitAfficherHeaderCfa?5:-1),e.R7$(),e.vxM(u.doitAfficherHeaderProfesseur?6:-1),e.R7$(),e.vxM(u.estUtilisateurConnecte?7:-1))},encapsulation:2})}return a})()},7136:(D,m,s)=>{s.d(m,{n:()=>_});var e=s(8457);let _=(()=>{class c{static \u0275fac=function(E){return new(E||c)};static \u0275cmp=e.VBU({type:c,selectors:[["app-footer"]],decls:5,vars:0,consts:[[1,"container"],[1,"footer-text"]],template:function(E,b){1&E&&(e.j41(0,"footer")(1,"div",0)(2,"div",1)(3,"p"),e.EFF(4,"\xa9 Digitalisation de l'\xe9margement"),e.k0s()()()())},encapsulation:2})}return c})()},7147:(D,m,s)=>{s.d(m,{Cy:()=>C,Gy:()=>c,ZU:()=>e,gN:()=>_});const e="accueil",_="dashboard-etudiant",c="dashboard-cfa",C="dashboard-professeur"}}]);