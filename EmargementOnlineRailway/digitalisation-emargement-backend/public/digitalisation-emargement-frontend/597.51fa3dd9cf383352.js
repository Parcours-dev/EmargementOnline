"use strict";(self.webpackChunkdigitalisation_emargement_frontend=self.webpackChunkdigitalisation_emargement_frontend||[]).push([[597],{597:(d,o,a)=>{a.r(o),a.d(o,{GenerationQrComponent:()=>h});var u=a(177),l=a(1626),e=a(8457),c=a(3242);const m=["qrCanvas"];let h=(()=>{class s{route;http;qrCanvas;qrMessage="Initialisation...";qr=null;intervalId=null;compteur=90;BASE_URL="https://emargementonline-production.up.railway.app/api";creneauId="";constructor(n,t){this.route=n,this.http=t}ngOnInit(){this.creneauId=this.route.snapshot.queryParams.creneau_id;const t=localStorage.getItem("_TOKEN_UTILISATEUR");if(!t)return void console.warn("Token manquant \u2014 pas de g\xe9n\xe9ration possible");const r=JSON.parse(t).token,i=(new l.Lr).set("Authorization",`Bearer ${r}`);this.demarrerGeneration(i)}demarrerGeneration(n){this.refreshQr(n),this.intervalId=setInterval(()=>{this.refreshQr(n)},5e3)}refreshQr(n){this.http.post(`${this.BASE_URL}/creneaux/${this.creneauId}/generate-qr`,{},{headers:n}).subscribe({next:t=>{const r=`http://localhost:5173/scan/${t.token}`;this.qrMessage=`QR actif \u2192 ${r}`,this.compteur=90,this.dessinerQR(r)},error:t=>{console.error(t),this.qrMessage="\u274c Erreur g\xe9n\xe9ration"}})}dessinerQR(n){this.qr?this.qr.value=n:this.qr=new QRious({element:this.qrCanvas.nativeElement,size:200,value:n})}ngOnDestroy(){this.intervalId&&clearInterval(this.intervalId)}static \u0275fac=function(t){return new(t||s)(e.rXU(c.nX),e.rXU(l.Qq))};static \u0275cmp=e.VBU({type:s,selectors:[["app-generation-qr"]],viewQuery:function(t,r){if(1&t&&e.GBs(m,7),2&t){let i;e.mGM(i=e.lsd())&&(r.qrCanvas=i.first)}},decls:10,vars:2,consts:[["qrCanvas",""],[1,"grayed-background","main-content","d-flex","justify-content-center","align-items-center","vh-100"],[1,"card","p-4","text-center",2,"width","300px"],[1,"mt-2","mb-0","text-muted","small"],["width","200","height","200",1,"my-3","mx-auto"],[1,"text-muted","small"]],template:function(t,r){1&t&&(e.j41(0,"main",1)(1,"div",2)(2,"h5"),e.EFF(3,"\u{1f393} QR Code d'\xc9margement"),e.k0s(),e.j41(4,"p",3),e.EFF(5),e.k0s(),e.nrm(6,"canvas",4,0),e.j41(8,"p",5),e.EFF(9),e.k0s()()()),2&t&&(e.R7$(5),e.SpI("Renouvellement dans ",r.compteur,"s"),e.R7$(4),e.JRh(r.qrMessage))},dependencies:[u.MD],encapsulation:2})}return s})()}}]);