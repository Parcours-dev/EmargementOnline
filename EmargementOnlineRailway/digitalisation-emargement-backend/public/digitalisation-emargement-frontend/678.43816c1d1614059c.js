"use strict";(self.webpackChunkdigitalisation_emargement_frontend=self.webpackChunkdigitalisation_emargement_frontend||[]).push([[678],{4678:(w,l,d)=>{d.r(l),d.d(l,{DashBoardEtudiantComponent:()=>O});var e=d(8457),p=d(7028),f=d(7136),c=d(177),_=d(1626),u=d(4341);const g=(i,a)=>({"text-success":i,"text-danger":a});function m(i,a){1&i&&(e.j41(0,"p",22),e.EFF(1,"\u23f3 Cours en cours"),e.k0s())}function h(i,a){1&i&&(e.j41(0,"p",23),e.EFF(1,"\u2705 Pr\xe9sent"),e.k0s())}function b(i,a){1&i&&(e.j41(0,"p",24),e.EFF(1,"\u274c Absent"),e.k0s())}function E(i,a){if(1&i&&(e.j41(0,"div",16)(1,"div",17)(2,"h5",18),e.EFF(3),e.k0s(),e.j41(4,"p"),e.EFF(5),e.nI1(6,"date"),e.nI1(7,"date"),e.k0s(),e.DNE(8,m,2,0,"p",19)(9,h,2,0,"p",20)(10,b,2,0,"p",21),e.k0s()()),2&i){const t=a.$implicit,n=e.XpG();e.Y8G("ngClass",n.getColorClasse(t)),e.R7$(3),e.JRh(t.nom_cours),e.R7$(2),e.Lme("",e.i5U(6,7,t.date_heure_debut,"shortTime")," - ",e.i5U(7,10,t.date_heure_fin,"shortTime"),""),e.R7$(3),e.Y8G("ngIf",t===n.coursEnCours&&!0!==t.present),e.R7$(),e.Y8G("ngIf",!0===t.present),e.R7$(),e.Y8G("ngIf",!1===t.present&&t!==n.coursEnCours)}}function C(i,a){if(1&i&&(e.j41(0,"option",25),e.EFF(1),e.k0s()),2&i){const t=a.$implicit;e.Y8G("value",t.jour),e.R7$(),e.JRh(t.jour)}}function D(i,a){if(1&i&&(e.j41(0,"div",47),e.EFF(1," \u2705 "),e.j41(2,"strong"),e.EFF(3),e.k0s(),e.EFF(4," pr\xeat \xe0 \xeatre envoy\xe9. "),e.k0s()),2&i){const t=e.XpG(3).$implicit;e.R7$(3),e.JRh(t.fichier.name)}}function F(i,a){1&i&&(e.j41(0,"div",48),e.EFF(1," \u2705 Justificatif envoy\xe9 avec succ\xe8s "),e.k0s())}function v(i,a){1&i&&(e.j41(0,"div",49),e.EFF(1," \u274c Erreur lors de l'envoi du justificatif "),e.k0s())}function x(i,a){if(1&i){const t=e.RV6();e.j41(0,"div",38)(1,"label",39),e.EFF(2,"D\xe9poser un justificatif (PDF ou image) :"),e.k0s(),e.j41(3,"div",40)(4,"input",41),e.bIt("change",function(r){e.eBV(t);const o=e.XpG(2).$implicit,s=e.XpG(2);return e.Njj(s.onFileSelected(r,o))}),e.k0s()(),e.DNE(5,D,5,1,"div",42),e.j41(6,"div",40)(7,"textarea",43),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG(2).$implicit;return e.DH7(o.commentaire,r)||(o.commentaire=r),e.Njj(r)}),e.k0s()(),e.j41(8,"button",44),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2).$implicit,o=e.XpG(2);return e.Njj(o.deposerJustificatif(r))}),e.EFF(9," \u{1f4e4} Envoyer le justificatif "),e.k0s(),e.DNE(10,F,2,0,"div",45)(11,v,2,0,"div",46),e.k0s()}if(2&i){const t=e.XpG(2).$implicit;e.R7$(5),e.Y8G("ngIf",t.fichier),e.R7$(2),e.R50("ngModel",t.commentaire),e.R7$(),e.Y8G("disabled",!t.fichier),e.R7$(2),e.Y8G("ngIf",t.depotOk),e.R7$(),e.Y8G("ngIf",t.depotErreur)}}function j(i,a){if(1&i){const t=e.RV6();e.j41(0,"div",35)(1,"button",36),e.bIt("click",function(){e.eBV(t);const r=e.XpG().$implicit;return e.Njj(r.toggleJustif=!r.toggleJustif)}),e.EFF(2),e.k0s(),e.DNE(3,x,12,5,"div",37),e.k0s()}if(2&i){const t=e.XpG().$implicit;e.R7$(2),e.SpI(" \u{1f4ce} ",t.toggleJustif?"Masquer le justificatif":"D\xe9poser un justificatif"," "),e.R7$(),e.Y8G("ngIf",t.toggleJustif)}}function M(i,a){if(1&i&&(e.j41(0,"li",30)(1,"div",31)(2,"div")(3,"strong"),e.EFF(4),e.k0s(),e.EFF(5," \u2014 "),e.j41(6,"span",32),e.EFF(7),e.k0s(),e.nrm(8,"br"),e.j41(9,"small",32),e.EFF(10),e.nI1(11,"date"),e.nI1(12,"date"),e.k0s()(),e.j41(13,"span",33),e.EFF(14),e.k0s()(),e.DNE(15,j,4,2,"div",34),e.k0s()),2&i){const t=a.$implicit,n=e.XpG(2);e.R7$(4),e.JRh(t.nom_cours),e.R7$(3),e.JRh(t.nom_groupe),e.R7$(3),e.Lme("",e.i5U(11,7,t.date_heure_debut,"shortTime")," - ",e.i5U(12,10,t.date_heure_fin,"shortTime"),""),e.R7$(3),e.Y8G("ngClass",e.l_i(13,g,t.present,!t.present)),e.R7$(),e.SpI(" ",t.present?"\u2705 Pr\xe9sent":"\u274c Absent"," "),e.R7$(),e.Y8G("ngIf",!t.present&&!n.estCoursAvenir(t))}}function k(i,a){if(1&i&&(e.j41(0,"div",26)(1,"h6",27),e.EFF(2),e.k0s(),e.j41(3,"ul",28),e.DNE(4,M,16,16,"li",29),e.k0s()()),2&i){const t=a.$implicit,n=e.XpG();e.Y8G("hidden",n.jourFiltre&&n.jourFiltre!==t.jour),e.R7$(2),e.JRh(t.jour),e.R7$(2),e.Y8G("ngForOf",t.cours)}}let O=(()=>{class i{coursDuJour=[];coursEnCours=null;coursSelectionne=null;statutEmargement=null;historique=[];jourFiltre="";dateDebut="";dateFin="";justificatifs=[];headers=null;qrCodeActif=null;BASE_URL=" https://emargementonline-production.up.railway.app/api";http=(0,e.WQX)(_.Qq);ngOnInit(){const t=localStorage.getItem("_TOKEN_UTILISATEUR");if(t){const n=JSON.parse(t);this.headers=(new _.Lr).set("Authorization",`Bearer ${n.token}`),this.chargerCours(),this.chargerHistorique(),this.chargerJustificatifs()}else console.warn("\u26a0\ufe0f Aucun token dans le localStorage")}chargerCours(){if(!this.headers)return;const t=(0,c.Yq)(new Date,"yyyy-MM-dd","fr");this.http.get(`${this.BASE_URL}/etudiants/mes-presences?date=${t}`,{headers:this.headers}).subscribe({next:r=>{this.coursDuJour=r,this.detecterCoursEnCours()},error:()=>console.error("\u274c Erreur chargement cours du jour")})}chargerHistorique(){this.headers&&this.http.get(`${this.BASE_URL}/etudiants/mes-presences`,{headers:this.headers}).subscribe({next:n=>{const r={};n.forEach(o=>{const s=new Date(o.date_heure_debut).toLocaleDateString("fr-FR",{weekday:"long"});r[s]||(r[s]=[]),o.commentaire="",o.fichier=null,o.depotOk=!1,o.depotErreur=!1,o.toggleJustif=!1,r[s].push(o)}),this.historique=Object.entries(r).map(([o,s])=>({jour:o,cours:s}))},error:()=>console.error("\u274c Erreur chargement historique")})}chargerJustificatifs(){this.headers&&this.http.get(`${this.BASE_URL}/etudiants/justificatifs`,{headers:this.headers}).subscribe({next:n=>this.justificatifs=n,error:()=>console.error("\u274c Erreur chargement justificatifs")})}appliquerFiltreDate(){!this.dateDebut&&!this.dateFin||this.historique.forEach(t=>{t.cours=t.cours.filter(n=>{const r=new Date(n.date_heure_debut),o=this.dateDebut?new Date(this.dateDebut):null,s=this.dateFin?new Date(this.dateFin):null;return(!o||r>=o)&&(!s||r<=s)})})}resetFiltreDate(){this.dateDebut="",this.dateFin="",this.chargerHistorique()}verifierStatutPresence(){this.statutEmargement=this.coursSelectionne?!!this.coursSelectionne.present:null}detecterCoursEnCours(){const t=(new Date).getTime();this.coursEnCours=this.coursDuJour.find(n=>{const r=new Date(n.date_heure_debut).getTime(),o=new Date(n.date_heure_fin).getTime();return t>=r&&t<=o})||null}getColorClasse(t){const n=(new Date).getTime(),r=new Date(t.date_heure_debut).getTime(),o=new Date(t.date_heure_fin).getTime();return!0===t.present?"border-success":!1===t.present&&n>o?"border-danger":null===t.present&&n<r?"border-info":n>=r&&n<=o&&!0!==t.present?"border-warning":"border-secondary"}estCoursAvenir(t){return(new Date).getTime()<new Date(t.date_heure_debut).getTime()&&null===t.present}onFileSelected(t,n){n.fichier=t.target.files[0],n.depotOk=!1,n.depotErreur=!1}deposerJustificatif(t){if(!this.headers)return;if(!t.fichier)return void alert("Veuillez s\xe9lectionner un fichier.");if(!t.id_groupe||isNaN(t.id_groupe))return void alert("Le groupe du cours est manquant ou invalide.");const n=new FormData;n.append("id_cours",t.id_cours),n.append("id_groupe",t.id_groupe.toString()),n.append("date_heure_debut",t.date_heure_debut),n.append("fichier",t.fichier),n.append("commentaire",t.commentaire||""),this.http.post(`${this.BASE_URL}/etudiants/justificatifs`,n,{headers:this.headers}).subscribe({next:()=>{t.commentaire="",t.fichier=null,t.depotOk=!0,t.depotErreur=!1,setTimeout(()=>{t.depotOk=!1},5e3),this.chargerHistorique()},error:r=>{console.error("\u274c Erreur lors de l\u2019envoi du justificatif",r),t.depotErreur=!0,setTimeout(()=>{t.depotErreur=!1},5e3)}})}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=e.VBU({type:i,selectors:[["app-dashboard-etudiant"]],decls:26,vars:6,consts:[[1,"grayed-background","main-content","py-4"],[1,"container"],[1,"row","g-4"],[1,"col-lg-4","col-md-6"],[1,"cours-du-jour"],["class","card mt-3 text-center",3,"ngClass",4,"ngFor","ngForOf"],[1,"col-lg-5","col-md-6"],[1,"historique"],[1,"d-flex","flex-wrap","gap-2","align-items-center","mb-3"],["type","date",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"form-select","w-auto","ms-auto",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"hidden",4,"ngFor","ngForOf"],[1,"card","mt-3","text-center",3,"ngClass"],[1,"card-body"],[1,"card-title"],["class","text-warning fw-bold",4,"ngIf"],["class","text-success fw-bold",4,"ngIf"],["class","text-danger fw-bold",4,"ngIf"],[1,"text-warning","fw-bold"],[1,"text-success","fw-bold"],[1,"text-danger","fw-bold"],[3,"value"],[3,"hidden"],[1,"text-capitalize","fw-semibold"],[1,"list-group","mb-3"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],[1,"d-flex","flex-column","flex-md-row","justify-content-between","align-items-md-center"],[1,"text-muted"],[1,"mt-2","mt-md-0","fw-bold","fs-5",3,"ngClass"],["class","mt-3",4,"ngIf"],[1,"mt-3"],[1,"btn","btn-outline-dark","btn-sm","mb-2",3,"click"],["class","p-3 border rounded bg-light",4,"ngIf"],[1,"p-3","border","rounded","bg-light"],[1,"form-label","fw-semibold"],[1,"mb-2"],["type","file","accept",".pdf,image/*",1,"form-control",3,"change"],["class","text-success mb-2",4,"ngIf"],["placeholder","Ex : certificat m\xe9dical, convocation...","rows","2",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-primary","btn-sm",3,"click","disabled"],["class","justif-success-badge mt-2 text-success fw-semibold",4,"ngIf"],["class","alert alert-danger mt-2 p-2",4,"ngIf"],[1,"text-success","mb-2"],[1,"justif-success-badge","mt-2","text-success","fw-semibold"],[1,"alert","alert-danger","mt-2","p-2"]],template:function(n,r){1&n&&(e.nrm(0,"app-header"),e.j41(1,"main",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"section",4)(6,"h5"),e.EFF(7,"Cours du jour"),e.k0s(),e.DNE(8,E,11,13,"div",5),e.k0s()(),e.j41(9,"div",6)(10,"section",7)(11,"h5"),e.EFF(12,"Historique de pr\xe9sence"),e.k0s(),e.j41(13,"div",8)(14,"input",9),e.mxI("ngModelChange",function(s){return e.DH7(r.dateDebut,s)||(r.dateDebut=s),s}),e.k0s(),e.j41(15,"input",9),e.mxI("ngModelChange",function(s){return e.DH7(r.dateFin,s)||(r.dateFin=s),s}),e.k0s(),e.j41(16,"button",10),e.bIt("click",function(){return r.appliquerFiltreDate()}),e.EFF(17,"Filtrer"),e.k0s(),e.j41(18,"button",11),e.bIt("click",function(){return r.resetFiltreDate()}),e.EFF(19,"R\xe9initialiser"),e.k0s(),e.j41(20,"select",12),e.mxI("ngModelChange",function(s){return e.DH7(r.jourFiltre,s)||(r.jourFiltre=s),s}),e.j41(21,"option",13),e.EFF(22,"-- Filtrer par jour --"),e.k0s(),e.DNE(23,C,2,2,"option",14),e.k0s()(),e.DNE(24,k,5,3,"div",15),e.k0s()()()()(),e.nrm(25,"app-footer")),2&n&&(e.R7$(8),e.Y8G("ngForOf",r.coursDuJour),e.R7$(6),e.R50("ngModel",r.dateDebut),e.R7$(),e.R50("ngModel",r.dateFin),e.R7$(5),e.R50("ngModel",r.jourFiltre),e.R7$(3),e.Y8G("ngForOf",r.historique),e.R7$(),e.Y8G("ngForOf",r.historique))},dependencies:[p.l,f.n,c.MD,c.YU,c.Sq,c.bT,c.vh,u.YN,u.xH,u.y7,u.me,u.wz,u.BC,u.vS],styles:[".main-content[_ngcontent-%COMP%]{padding-top:20px;padding-bottom:40px;background-color:#f5f7fa}.container[_ngcontent-%COMP%]{display:flex;justify-content:center}.row.g-4[_ngcontent-%COMP%]{display:flex;gap:2rem;width:100%;max-width:1200px;margin:auto;min-height:80vh}.col-lg-4[_ngcontent-%COMP%], .col-md-6[_ngcontent-%COMP%], .col-lg-5[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.cours-du-jour[_ngcontent-%COMP%]{background-color:#fff;padding:1.5rem;border-radius:16px;box-shadow:0 4px 12px #0000000d;height:100%}.historique[_ngcontent-%COMP%]{background-color:#fff;padding:1.5rem;border-radius:16px;box-shadow:0 4px 12px #0000000d;height:100%;max-height:75vh;overflow-y:auto;scrollbar-width:thin;scrollbar-color:#ccc transparent}.historique[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.historique[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#ccc;border-radius:10px}.card[_ngcontent-%COMP%]{border-radius:16px;box-shadow:0 4px 12px #0000000d;transition:transform .2s ease}.card[_ngcontent-%COMP%]:hover{transform:scale(1.01)}.card-body[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:600;color:#333}.text-success[_ngcontent-%COMP%]{color:#28a745!important;font-weight:700}.text-danger[_ngcontent-%COMP%]{color:#dc3545!important;font-weight:700}.text-warning[_ngcontent-%COMP%]{color:#ffc107!important;font-weight:700}.form-select[_ngcontent-%COMP%]{border-radius:12px;padding:8px 12px;font-size:.95rem}.card-body[_ngcontent-%COMP%]   select.form-select[_ngcontent-%COMP%]{min-width:180px;font-size:.95rem}.list-group-item[_ngcontent-%COMP%]{border:none;border-radius:8px;background-color:#f9f9f9;margin-bottom:6px;padding:10px 16px}.border-success[_ngcontent-%COMP%]{border:2px solid #28a745!important}.border-danger[_ngcontent-%COMP%]{border:2px solid #dc3545!important}.border-warning[_ngcontent-%COMP%]{border:2px solid #ffc107!important}.border-secondary[_ngcontent-%COMP%]{border:2px solid #6c757d!important}.border-upcoming[_ngcontent-%COMP%]{border:2px dashed #6c757d!important}label[_ngcontent-%COMP%]{font-weight:500}@media (max-width: 768px){.dashboard-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.card-body[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:1rem}.cours-du-jour[_ngcontent-%COMP%], .historique[_ngcontent-%COMP%]{padding:1rem;box-shadow:none;border-radius:12px;max-height:none;overflow:visible}}"]})}return i})()}}]);