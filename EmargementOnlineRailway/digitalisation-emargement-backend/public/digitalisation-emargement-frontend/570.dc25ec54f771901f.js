"use strict";(self.webpackChunkdigitalisation_emargement_frontend=self.webpackChunkdigitalisation_emargement_frontend||[]).push([[570],{2570:(R,h,u)=>{u.r(h),u.d(h,{DashBoardProfesseurComponent:()=>I});var e=u(8457),f=u(177),d=u(1626),b=u(7028),g=u(7136);const m=r=>({"border border-warning bg-light":r}),C=(r,p)=>({"text-success":r,"text-danger":p});function v(r,p){if(1&r){const t=e.RV6();e.j41(0,"button",15),e.bIt("click",function(){e.eBV(t);const s=e.XpG().$implicit,c=e.XpG(2);return e.Njj(c.lancerGenerationQr(s))}),e.EFF(1," \u{1f680} G\xe9n\xe9rer QR Code "),e.k0s()}}function D(r,p){if(1&r){const t=e.RV6();e.j41(0,"button",23),e.bIt("click",function(){e.eBV(t);const s=e.XpG().$implicit,c=e.XpG(4);return e.Njj(c.validerPresenceManuelle(s.email))}),e.EFF(1," Valider "),e.k0s()}}function a(r,p){if(1&r&&(e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td")(8,"span",21),e.EFF(9),e.k0s()(),e.j41(10,"td"),e.DNE(11,D,2,0,"button",22),e.k0s()()),2&r){const t=p.$implicit;e.R7$(2),e.JRh(t.nom),e.R7$(2),e.JRh(t.prenom),e.R7$(2),e.JRh(t.email),e.R7$(2),e.Y8G("ngClass",e.l_i(6,C,t.present,!t.present)),e.R7$(),e.SpI(" ",t.present?"Pr\xe9sent":"Absent"," "),e.R7$(2),e.Y8G("ngIf",!t.present)}}function E(r,p){if(1&r&&(e.j41(0,"div",16)(1,"h6"),e.EFF(2,"\u{1f465} \xc9tudiants attendus"),e.k0s(),e.j41(3,"div",17)(4,"table",18)(5,"thead",19)(6,"tr")(7,"th"),e.EFF(8,"Nom"),e.k0s(),e.j41(9,"th"),e.EFF(10,"Pr\xe9nom"),e.k0s(),e.j41(11,"th"),e.EFF(12,"Email"),e.k0s(),e.j41(13,"th"),e.EFF(14,"Statut"),e.k0s(),e.j41(15,"th"),e.EFF(16,"Action"),e.k0s()()(),e.j41(17,"tbody"),e.DNE(18,a,12,9,"tr",20),e.k0s()()()()),2&r){const t=e.XpG(3);e.R7$(18),e.Y8G("ngForOf",t.etudiantsCours)}}function i(r,p){if(1&r&&(e.j41(0,"div",8)(1,"div",9)(2,"div",10)(3,"div")(4,"h6",11),e.EFF(5),e.k0s(),e.j41(6,"small"),e.EFF(7),e.k0s(),e.nrm(8,"br"),e.j41(9,"small",12),e.EFF(10),e.nI1(11,"date"),e.nI1(12,"date"),e.k0s()(),e.DNE(13,v,2,0,"button",13),e.k0s(),e.DNE(14,E,19,1,"div",14),e.k0s()()),2&r){const t=p.$implicit,n=e.XpG(2);e.Y8G("ngClass",e.eq3(13,m,t===n.coursEnCours)),e.R7$(5),e.JRh(t.nom_cours),e.R7$(2),e.JRh(t.nom_groupe),e.R7$(3),e.Lme(" ",e.i5U(11,7,t.date_heure_debut,"shortTime")," - ",t.date_heure_fin?e.i5U(12,10,t.date_heure_fin,"shortTime"):"\u2014"," "),e.R7$(3),e.Y8G("ngIf",t===n.coursEnCours),e.R7$(),e.Y8G("ngIf",t===n.coursEnCours&&n.etudiantsCours.length>0)}}function _(r,p){if(1&r&&(e.qex(0),e.DNE(1,i,15,15,"div",7),e.bVm()),2&r){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.coursDuJour)}}function o(r,p){1&r&&(e.j41(0,"p",12),e.EFF(1,"Aucun cours pr\xe9vu aujourd'hui."),e.k0s())}let I=(()=>{class r{coursDuJour=[];coursEnCours=null;etudiantsCours=[];refreshInterval;BASE_URL="https://emargementonline-production.up.railway.app/api";http=(0,e.WQX)(d.Qq);ngOnInit(){const t=localStorage.getItem("_TOKEN_UTILISATEUR");if(!t)return void console.error("\u274c Aucun token trouv\xe9 dans le localStorage");const n=JSON.parse(t),s=this.decodeToken(n.token);if(!s?.id)return void console.error("\u274c Impossible de d\xe9terminer l\u2019ID du professeur");const c=s.id,l=(new d.Lr).set("Authorization",`Bearer ${n.token}`);this.chargerEmploiDuTemps(c,l)}decodeToken(t){try{const n=t.split(".")[1];return JSON.parse(atob(n))}catch(n){return console.error("Erreur d\xe9codage token :",n),null}}chargerEmploiDuTemps(t,n){this.http.get(`${this.BASE_URL}/enseignants/${t}/emplois`,{headers:n}).subscribe({next:s=>{const c=(new Date).toISOString().split("T")[0];this.coursDuJour=s.filter(l=>new Date(l.date_heure_debut).toISOString().startsWith(c)),this.detecterCoursEnCours(n)},error:()=>{console.error("\u274c Erreur lors du chargement de l'emploi du temps du jour")}})}detecterCoursEnCours(t){const n=Date.now();this.coursEnCours=this.coursDuJour.find(s=>{const c=new Date(s.date_heure_debut).getTime(),l=new Date(s.date_heure_fin).getTime();return n>=c&&n<=l})||null,this.coursEnCours?(this.chargerEtudiantsCoursEnCours(t),this.refreshInterval=setInterval(()=>{this.chargerEtudiantsCoursEnCours(t)},3e3)):this.refreshInterval&&clearInterval(this.refreshInterval)}chargerEtudiantsCoursEnCours(t){if(!this.coursEnCours)return;const{id_cours:n,id_groupe:s,date_heure_debut:c}=this.coursEnCours,l=new URLSearchParams({id_cours:n,id_groupe:s,date_heure_debut:c});this.http.get(`${this.BASE_URL}/presences/controle?${l.toString()}`,{headers:t}).subscribe({next:F=>{this.etudiantsCours=F},error:()=>{console.error("\u274c Erreur lors du chargement des \xe9tudiants du cours")}})}validerPresenceManuelle(t){const n=JSON.parse(localStorage.getItem("_TOKEN_UTILISATEUR")).token,s=(new d.Lr).set("Authorization",`Bearer ${n}`);this.http.patch(`${this.BASE_URL}/presences/valider`,{email:t,id_cours:this.coursEnCours.id_cours,id_groupe:this.coursEnCours.id_groupe,date_heure_debut:this.coursEnCours.date_heure_debut},{headers:s}).subscribe({next:l=>{alert(l.message||"Pr\xe9sence valid\xe9e"),this.chargerEtudiantsCoursEnCours(s)},error:()=>alert("\u274c Erreur lors de la validation")})}lancerGenerationQr(t){const n=t.id_cours,s=t.id_groupe,c=t.id_professeur,l=new Date(t.date_heure_debut),F=new Date(l.getTime()-72e5),T=(0,f.Yq)(F,"yyyy-MM-dd HH:mm:ss","fr-FR"),U=encodeURIComponent(`${n}-${s}-${c}-${T}`);window.open(`https://emargementonline-production.up.railway.app/generation-qr?creneau_id=${U}`,"_blank","width=420,height=500")}ngOnDestroy(){this.refreshInterval&&clearInterval(this.refreshInterval)}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=e.VBU({type:r,selectors:[["app-dashboard-professeur"]],decls:11,vars:2,consts:[["aucunCours",""],[1,"grayed-background","main-content"],[1,"container","py-4"],[1,"card"],[1,"card-body"],[1,"mb-3"],[4,"ngIf","ngIfElse"],["class","card shadow-sm mb-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"card","shadow-sm","mb-2",3,"ngClass"],[1,"card-body","p-2"],[1,"d-flex","justify-content-between","align-items-center"],[1,"mb-1"],[1,"text-muted"],["class","btn btn-sm btn-outline-success ms-3",3,"click",4,"ngIf"],["class","mt-3",4,"ngIf"],[1,"btn","btn-sm","btn-outline-success","ms-3",3,"click"],[1,"mt-3"],[2,"max-height","400px","overflow-y","auto"],[1,"table","table-sm","table-bordered","mt-2"],[1,"table-light"],[4,"ngFor","ngForOf"],[3,"ngClass"],["class","btn btn-sm btn-outline-primary",3,"click",4,"ngIf"],[1,"btn","btn-sm","btn-outline-primary",3,"click"]],template:function(n,s){if(1&n&&(e.nrm(0,"app-header"),e.j41(1,"main",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h5",5),e.EFF(6,"Cours \xe0 venir aujourd'hui"),e.k0s(),e.DNE(7,_,2,1,"ng-container",6)(8,o,2,0,"ng-template",null,0,e.C5r),e.k0s()()()(),e.nrm(10,"app-footer")),2&n){const c=e.sdS(9);e.R7$(7),e.Y8G("ngIf",s.coursDuJour.length>0)("ngIfElse",c)}},dependencies:[b.l,g.n,f.MD,f.YU,f.Sq,f.bT,f.vh],encapsulation:2})}return r})()},7028:(R,h,u)=>{u.d(h,{l:()=>D});var e=u(8457),f=u(3242),d=u(7147);function b(a,E){if(1&a&&(e.j41(0,"a",2),e.EFF(1),e.k0s()),2&a){const i=e.XpG();e.R7$(),e.SpI("Bonjour ",i.nomUtilisateur,"")}}function g(a,E){if(1&a){const i=e.RV6();e.j41(0,"a",6),e.bIt("click",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.redirigeVerPageDashboardEtudiant())}),e.EFF(1,"Tableau de bord Etudiant"),e.k0s()}}function m(a,E){if(1&a){const i=e.RV6();e.j41(0,"a",6),e.bIt("click",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.redirigeVerPageDashboardCfa())}),e.EFF(1,"Tableau de bord CFA"),e.k0s(),e.j41(2,"a",6),e.bIt("click",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.redirigeVerPageRapportAbsence())}),e.EFF(3,"Rapport des absences"),e.k0s()}}function C(a,E){if(1&a){const i=e.RV6();e.j41(0,"a",6),e.bIt("click",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.redirigeVerPageDashboardProfesseur())}),e.EFF(1,"Tableau de bord Professeur"),e.k0s()}}function v(a,E){if(1&a){const i=e.RV6();e.j41(0,"button",7),e.bIt("click",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.deconnecterUtilisateur())}),e.EFF(1," D\xe9connexion "),e.k0s()}}let D=(()=>{class a{router=(0,e.WQX)(f.Ix);doitAfficherHeaderEtudiant=!1;doitAfficherHeaderProfesseur=!1;doitAfficherHeaderCfa=!1;estUtilisateurConnecte=!1;nomUtilisateur="";ROLE_PROFESSEUR="professeur";ROLE_ETUDIANT="etudiant";ROLE_CFA="cfa";ngOnInit(){this.affichageHeader()}deconnecterUtilisateur(){typeof window<"u"&&(localStorage.removeItem("_TOKEN_UTILISATEUR"),localStorage.removeItem("_INFOS_UTILISATEUR"),localStorage.clear()),this.router.navigateByUrl(`${d.ZU}`)}redirigeVerPageDashboardEtudiant(){this.router.navigateByUrl(`${d.gN}`)}redirigeVerPageDashboardCfa(){this.router.navigateByUrl(`${d.Gy}`)}redirigeVerPageDashboardProfesseur(){this.router.navigateByUrl(`${d.Cy}`)}redirigeVerPageRapportAbsence(){this.router.navigateByUrl(`${d.dh}`)}affichageHeader(){if(typeof window>"u")return;const i=localStorage.getItem("_INFOS_UTILISATEUR"),_=localStorage.getItem("_TOKEN_UTILISATEUR");if(!i||!_)return void(this.estUtilisateurConnecte=!1);const o=JSON.parse(i),I=JSON.parse(_);this.nomUtilisateur=o.nom+" "+o.prenom,o.role===this.ROLE_ETUDIANT&&(this.doitAfficherHeaderEtudiant=!0),o.role===this.ROLE_CFA&&(this.doitAfficherHeaderCfa=!0),o.role===this.ROLE_PROFESSEUR&&(this.doitAfficherHeaderProfesseur=!0),null!==I?.token&&(this.estUtilisateurConnecte=!0)}static \u0275fac=function(_){return new(_||a)};static \u0275cmp=e.VBU({type:a,selectors:[["app-header"]],decls:8,vars:5,consts:[[1,"navbar","navbar-expand-lg","navbar-dark"],[1,"container-fluid"],[1,"navbar-brand"],[1,"d-flex","justify-content-center","flex-grow-1"],[1,"navbar-brand","navbar-link-small",2,"cursor","pointer"],[1,"btn","btn-white","ms-auto","deconnexion-btn"],[1,"navbar-brand","navbar-link-small",2,"cursor","pointer",3,"click"],[1,"btn","btn-white","ms-auto","deconnexion-btn",3,"click"]],template:function(_,o){1&_&&(e.j41(0,"nav",0)(1,"div",1),e.DNE(2,b,2,1,"a",2),e.j41(3,"div",3),e.DNE(4,g,2,0,"a",4)(5,m,4,0)(6,C,2,0,"a",4),e.k0s(),e.DNE(7,v,2,0,"button",5),e.k0s()()),2&_&&(e.R7$(2),e.vxM(o.estUtilisateurConnecte?2:-1),e.R7$(2),e.vxM(o.doitAfficherHeaderEtudiant?4:-1),e.R7$(),e.vxM(o.doitAfficherHeaderCfa?5:-1),e.R7$(),e.vxM(o.doitAfficherHeaderProfesseur?6:-1),e.R7$(),e.vxM(o.estUtilisateurConnecte?7:-1))},encapsulation:2})}return a})()},7136:(R,h,u)=>{u.d(h,{n:()=>f});var e=u(8457);let f=(()=>{class d{static \u0275fac=function(m){return new(m||d)};static \u0275cmp=e.VBU({type:d,selectors:[["app-footer"]],decls:5,vars:0,consts:[[1,"container"],[1,"footer-text"]],template:function(m,C){1&m&&(e.j41(0,"footer")(1,"div",0)(2,"div",1)(3,"p"),e.EFF(4,"\xa9 Digitalisation de l'\xe9margement"),e.k0s()()()())},encapsulation:2})}return d})()}}]);