import{A as c,Ca as C,K as i,L as a,M as p,S as d,T as u,U as h,W as s,X as v,Y as f,ua as g,va as I,wa as y,x as o,z as l}from"./chunk-NEFVD2IN.js";var Q=["qrCanvas"],q=class m{constructor(t,e){this.route=t;this.http=e}qrCanvas;qrMessage="Initialisation...";qr=null;intervalId=null;compteur=90;BASE_URL="http://localhost:3000/api";creneauId="";ngOnInit(){let t=this.route.snapshot.queryParams;this.creneauId=t.creneau_id;let e=localStorage.getItem("_TOKEN_UTILISATEUR");if(!e){console.warn("Token manquant \u2014 pas de g\xE9n\xE9ration possible");return}let n=JSON.parse(e).token,r=new I().set("Authorization",`Bearer ${n}`);this.demarrerGeneration(r)}demarrerGeneration(t){this.refreshQr(t),this.intervalId=setInterval(()=>{this.refreshQr(t)},5e3)}refreshQr(t){this.http.post(`${this.BASE_URL}/creneaux/${this.creneauId}/generate-qr`,{},{headers:t}).subscribe({next:e=>{let n=`http://localhost:5173/scan/${e.token}`;this.qrMessage=`QR actif \u2192 ${n}`,this.compteur=90,this.dessinerQR(n)},error:e=>{console.error(e),this.qrMessage="\u274C Erreur g\xE9n\xE9ration"}})}dessinerQR(t){this.qr?this.qr.value=t:this.qr=new QRious({element:this.qrCanvas.nativeElement,size:200,value:t})}ngOnDestroy(){this.intervalId&&clearInterval(this.intervalId)}static \u0275fac=function(e){return new(e||m)(l(C),l(y))};static \u0275cmp=c({type:m,selectors:[["app-generation-qr"]],viewQuery:function(e,n){if(e&1&&d(Q,7),e&2){let r;u(r=h())&&(n.qrCanvas=r.first)}},decls:10,vars:2,consts:[["qrCanvas",""],[1,"grayed-background","main-content","d-flex","justify-content-center","align-items-center","vh-100"],[1,"card","p-4","text-center",2,"width","300px"],[1,"mt-2","mb-0","text-muted","small"],["width","200","height","200",1,"my-3","mx-auto"],[1,"text-muted","small"]],template:function(e,n){e&1&&(i(0,"main",1)(1,"div",2)(2,"h5"),s(3,"\u{1F393} QR Code d'\xC9margement"),a(),i(4,"p",3),s(5),a(),p(6,"canvas",4,0),i(8,"p",5),s(9),a()()()),e&2&&(o(5),f("Renouvellement dans ",n.compteur,"s"),o(4),v(n.qrMessage))},dependencies:[g],encapsulation:2})};export{q as GenerationQrComponent};
