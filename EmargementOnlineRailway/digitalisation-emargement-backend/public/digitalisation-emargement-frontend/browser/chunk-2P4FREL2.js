import{a as J,b as L}from"./chunk-L2QAGXGE.js";import"./chunk-3AJ3FCXW.js";import{A as y,E as m,H as c,K as o,L as i,M as _,N as D,O as I,P as C,Q as E,R as l,V as T,W as s,X as p,Y as w,Z as P,ca as B,da as k,ea as b,fa as x,ga as $,o as S,oa as O,q as f,qa as A,r as g,ra as F,sa as H,ta as N,ua as R,va as v,wa as U,x as d}from"./chunk-NEFVD2IN.js";var j=n=>({"border border-warning bg-light":n}),G=(n,t)=>({"text-success":n,"text-danger":t});function Q(n,t){if(n&1){let e=C();o(0,"button",15),E("click",function(){f(e);let a=l().$implicit,u=l(2);return g(u.lancerGenerationQr(a))}),s(1," \u{1F680} G\xE9n\xE9rer QR Code "),i()}}function z(n,t){if(n&1){let e=C();o(0,"button",22),E("click",function(){f(e);let a=l().$implicit,u=l(4);return g(u.validerPresenceManuelle(a.email))}),s(1," Valider "),i()}}function K(n,t){if(n&1&&(o(0,"tr")(1,"td"),s(2),i(),o(3,"td"),s(4),i(),o(5,"td"),s(6),i(),o(7,"td")(8,"span",20),s(9),i()(),o(10,"td"),m(11,z,2,0,"button",21),i()()),n&2){let e=t.$implicit;d(2),p(e.nom),d(2),p(e.prenom),d(2),p(e.email),d(2),c("ngClass",k(6,G,e.present,!e.present)),d(),w(" ",e.present?"Pr\xE9sent":"Absent"," "),d(2),c("ngIf",!e.present)}}function q(n,t){if(n&1&&(o(0,"div",16)(1,"h6"),s(2,"\u{1F465} \xC9tudiants attendus"),i(),o(3,"table",17)(4,"thead",18)(5,"tr")(6,"th"),s(7,"Nom"),i(),o(8,"th"),s(9,"Pr\xE9nom"),i(),o(10,"th"),s(11,"Email"),i(),o(12,"th"),s(13,"Statut"),i(),o(14,"th"),s(15,"Action"),i()()(),o(16,"tbody"),m(17,K,12,9,"tr",19),i()()()),n&2){let e=l(3);d(17),c("ngForOf",e.etudiantsCours)}}function W(n,t){if(n&1&&(o(0,"div",8)(1,"div",9)(2,"div",10)(3,"div")(4,"h6",11),s(5),i(),o(6,"small"),s(7),i(),_(8,"br"),o(9,"small",12),s(10),b(11,"date"),b(12,"date"),i()(),m(13,Q,2,0,"button",13),i(),m(14,q,18,1,"div",14),i()()),n&2){let e=t.$implicit,r=l(2);c("ngClass",B(13,j,e===r.coursEnCours)),d(5),p(e.nom_cours),d(2),p(e.nom_groupe),d(3),P(" ",x(11,7,e.date_heure_debut,"shortTime")," - ",e.date_heure_fin?x(12,10,e.date_heure_fin,"shortTime"):"\u2014"," "),d(3),c("ngIf",e===r.coursEnCours),d(),c("ngIf",e===r.coursEnCours&&r.etudiantsCours.length>0)}}function X(n,t){if(n&1&&(D(0),m(1,W,15,15,"div",7),I()),n&2){let e=l();d(),c("ngForOf",e.coursDuJour)}}function Y(n,t){n&1&&(o(0,"p",12),s(1,"Aucun cours pr\xE9vu aujourd'hui."),i())}var M=class n{coursDuJour=[];coursEnCours=null;etudiantsCours=[];BASE_URL="http://localhost:3000/api";http=S(U);ngOnInit(){let t=localStorage.getItem("_TOKEN_UTILISATEUR");if(!t){console.error("\u274C Aucun token trouv\xE9 dans le localStorage");return}let e=JSON.parse(t),r=this.decodeToken(e.token);if(!r?.id){console.error("\u274C Impossible de d\xE9terminer l\u2019ID du professeur");return}let a=r.id,u=new v().set("Authorization",`Bearer ${e.token}`);this.chargerEmploiDuTemps(a,u)}decodeToken(t){try{let e=t.split(".")[1];return JSON.parse(atob(e))}catch(e){return console.error("Erreur d\xE9codage token :",e),null}}chargerEmploiDuTemps(t,e){this.http.get(`${this.BASE_URL}/enseignants/${t}/emplois`,{headers:e}).subscribe({next:r=>{let a=new Date().toISOString().split("T")[0];this.coursDuJour=r.filter(u=>new Date(u.date_heure_debut).toISOString().startsWith(a)),this.detecterCoursEnCours(e)},error:()=>{console.error("\u274C Erreur lors du chargement de l'emploi du temps du jour")}})}detecterCoursEnCours(t){let e=Date.now();this.coursEnCours=this.coursDuJour.find(r=>{let a=new Date(r.date_heure_debut).getTime(),u=new Date(r.date_heure_fin).getTime();return e>=a&&e<=u})||null,this.coursEnCours&&this.chargerEtudiantsCoursEnCours(t)}chargerEtudiantsCoursEnCours(t){if(!this.coursEnCours)return;let{id_cours:e,id_groupe:r,date_heure_debut:a}=this.coursEnCours,u=new URLSearchParams({id_cours:e,id_groupe:r,date_heure_debut:a});this.http.get(`${this.BASE_URL}/presences/controle?${u.toString()}`,{headers:t}).subscribe({next:h=>{this.etudiantsCours=h},error:()=>{console.error("\u274C Erreur lors du chargement des \xE9tudiants du cours")}})}validerPresenceManuelle(t){let e=JSON.parse(localStorage.getItem("_TOKEN_UTILISATEUR")).token,r=new v().set("Authorization",`Bearer ${e}`),a={email:t,id_cours:this.coursEnCours.id_cours,id_groupe:this.coursEnCours.id_groupe,date_heure_debut:this.coursEnCours.date_heure_debut};this.http.patch(`${this.BASE_URL}/presences/valider`,a,{headers:r}).subscribe({next:u=>{alert(u.message||"Pr\xE9sence valid\xE9e"),this.chargerEtudiantsCoursEnCours(r)},error:()=>alert("\u274C Erreur lors de la validation")})}lancerGenerationQr(t){let e=t.id_cours,r=t.id_groupe,a=t.id_professeur,u=O(t.date_heure_debut,"yyyy-MM-dd HH:mm:ss","fr-FR"),h=`${e}-${r}-${a}-${u}`,V=encodeURIComponent(h);window.open(`http://localhost:4200/generation-qr?creneau_id=${V}`,"_blank","width=420,height=500")}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=y({type:n,selectors:[["app-dashboard-professeur"]],decls:11,vars:2,consts:[["aucunCours",""],[1,"grayed-background","main-content"],[1,"container","py-4"],[1,"card"],[1,"card-body"],[1,"mb-3"],[4,"ngIf","ngIfElse"],["class","card shadow-sm mb-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"card","shadow-sm","mb-2",3,"ngClass"],[1,"card-body","p-2"],[1,"d-flex","justify-content-between","align-items-center"],[1,"mb-1"],[1,"text-muted"],["class","btn btn-sm btn-outline-success ms-3",3,"click",4,"ngIf"],["class","mt-3",4,"ngIf"],[1,"btn","btn-sm","btn-outline-success","ms-3",3,"click"],[1,"mt-3"],[1,"table","table-sm","table-bordered","mt-2"],[1,"table-light"],[4,"ngFor","ngForOf"],[3,"ngClass"],["class","btn btn-sm btn-outline-primary",3,"click",4,"ngIf"],[1,"btn","btn-sm","btn-outline-primary",3,"click"]],template:function(e,r){if(e&1&&(_(0,"app-header"),o(1,"main",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h5",5),s(6,"Cours \xE0 venir aujourd'hui"),i(),m(7,X,2,1,"ng-container",6)(8,Y,2,0,"ng-template",null,0,$),i()()()(),_(10,"app-footer")),e&2){let a=T(9);d(7),c("ngIf",r.coursDuJour.length>0)("ngIfElse",a)}},dependencies:[J,L,R,A,F,H,N],encapsulation:2})};export{M as DashBoardProfesseurComponent};
