import './polyfills.server.mjs';
import{a as v,b as W,c as P,d as L,e as N,f as O,g as k,j as F,k as B,l as U,o as j}from"./chunk-JMBVQVKA.mjs";import{d as I,e as R}from"./chunk-ODDJQNII.mjs";import{F as a,I as y,M as _,T as d,Ta as M,Ua as x,Va as A,W as t,X as n,Xa as w,Y as h,aa as b,ab as D,ba as g,bb as T,ga as r,ha as f,ia as S,ja as E,k as C,ka as m,la as c,ma as u}from"./chunk-MDY4ZS66.mjs";import"./chunk-AFOT676I.mjs";function H(l,p){l&1&&(t(0,"th"),r(1,"IP"),n())}function V(l,p){l&1&&(t(0,"th"),r(1,"User Agent"),n())}function z(l,p){l&1&&(t(0,"th"),r(1,"Ajout manuel"),n())}function G(l,p){if(l&1&&(t(0,"td"),r(1),n()),l&2){let o=g().$implicit;a(),f(o.ip_adresse||"")}}function J(l,p){if(l&1&&(t(0,"td"),r(1),n()),l&2){let o=g().$implicit;a(),f((o.user_agent==null?null:o.user_agent.substring(0,30))||"")}}function K(l,p){if(l&1&&(t(0,"td"),r(1),n()),l&2){let o=g().$implicit;a(),f(o.ajout_manuel?"Oui":"Non")}}function Q(l,p){if(l&1&&(t(0,"tr")(1,"td"),r(2),n(),t(3,"td"),r(4),n(),t(5,"td"),r(6),n(),t(7,"td"),r(8),n(),t(9,"td",32),r(10),n(),_(11,G,2,1,"td",30)(12,J,2,1,"td",30)(13,K,2,1,"td",30),n()),l&2){let o=p.$implicit,e=g();a(2),E("",o.nom," ",o.prenom,""),a(2),f(o.nom_cours),a(2),f(o.date_heure_debut),a(2),f(o.date_heure_fin),a(),d("ngClass",o.present?"text-success":"text-danger"),a(),S(" ",o.present?"\u2705 Pr\xE9sent":"\u274C Absent"," "),a(),d("ngIf",e.filtres.includeDetails),a(),d("ngIf",e.filtres.includeDetails),a(),d("ngIf",e.filtres.includeDetails)}}function X(l,p){l&1&&(t(0,"tr")(1,"td",33),r(2,"Aucun r\xE9sultat \xE0 afficher."),n()())}var q=class l{API="http://localhost:3000/api";http=C(T);headers=null;resultats=[];filtres={promo:"",id_groupe_TD:"",id_groupe_Anglais:"",email:"",date:"",from:"",to:"",type:"",includeDetails:!1};ngOnInit(){let p=localStorage.getItem("_TOKEN_UTILISATEUR");if(p){let o=JSON.parse(p);this.headers=new D().set("Authorization",`Bearer ${o.token}`)}}appliquerFiltres(){if(!this.headers)return;let p=new URLSearchParams;Object.entries(this.filtres).forEach(([o,e])=>{typeof e=="boolean"?e&&p.append(o,"true"):e&&p.append(o,e)}),this.http.get(`${this.API}/cfa/export?${p.toString()}`,{headers:this.headers}).subscribe({next:o=>this.resultats=o,error:()=>console.error("\u274C Erreur chargement des pr\xE9sences")})}exporter(){if(!this.headers)return;if(this.resultats.length===0){alert("Aucune donn\xE9e \xE0 exporter. Appliquez des filtres d'abord.");return}let p=new URLSearchParams;Object.entries(this.filtres).forEach(([o,e])=>{typeof e=="boolean"?e&&p.append(o,"true"):e&&p.append(o,e)}),p.append("export","true"),this.http.get(`${this.API}/cfa/export-file?${p.toString()}`,{headers:this.headers,responseType:"blob"}).subscribe({next:o=>{let e=`export_${new Date().toISOString().slice(0,10)}.xlsx`,s=window.URL.createObjectURL(o),i=document.createElement("a");i.href=s,i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(s)},error:()=>{console.error("\u274C Erreur export fichier"),alert("Erreur lors de l'export. V\xE9rifiez votre connexion ou token.")}})}static \u0275fac=function(o){return new(o||l)};static \u0275cmp=y({type:l,selectors:[["app-rapport-absence"]],decls:77,vars:14,consts:[[1,"grayed-background","main-content"],[1,"container"],[1,"mb-4"],[1,"card","p-4","mb-4",3,"ngSubmit"],[1,"row","g-3"],[1,"col-md-4"],[1,"form-label"],["name","promo","placeholder","Ex: 2023-A",1,"form-control",3,"ngModelChange","ngModel"],["name","id_groupe_TD",1,"form-control",3,"ngModelChange","ngModel"],["name","id_groupe_Anglais",1,"form-control",3,"ngModelChange","ngModel"],["name","email",1,"form-control",3,"ngModelChange","ngModel"],["type","date","name","date",1,"form-control",3,"ngModelChange","ngModel"],[1,"d-flex","gap-2"],["type","date","name","from",1,"form-control",3,"ngModelChange","ngModel"],["type","date","name","to",1,"form-control",3,"ngModelChange","ngModel"],["name","type",1,"form-select",3,"ngModelChange","ngModel"],["value",""],["value","presents"],["value","absents"],[1,"col-md-4","d-flex","align-items-center"],[1,"form-check","mt-4"],["type","checkbox","id","withInfos","name","includeDetails",1,"form-check-input",3,"ngModelChange","ngModel"],["for","withInfos",1,"form-check-label"],[1,"d-flex","gap-3","mt-4"],["type","submit",1,"btn","btn-primary"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"card","p-3"],[1,"mb-3"],[1,"table-responsive"],[1,"table","table-bordered"],[4,"ngIf"],[4,"ngFor","ngForOf"],[3,"ngClass"],["colspan","8",1,"text-center","text-muted"]],template:function(o,e){o&1&&(h(0,"app-header"),t(1,"main",0)(2,"div",1)(3,"h2",2),r(4,"\u{1F4CA} Rapport des Absences"),n(),t(5,"form",3),b("ngSubmit",function(){return e.appliquerFiltres()}),t(6,"div",4)(7,"div",5)(8,"label",6),r(9,"Promotion"),n(),t(10,"input",7),u("ngModelChange",function(i){return c(e.filtres.promo,i)||(e.filtres.promo=i),i}),n()(),t(11,"div",5)(12,"label",6),r(13,"Groupe TD"),n(),t(14,"input",8),u("ngModelChange",function(i){return c(e.filtres.id_groupe_TD,i)||(e.filtres.id_groupe_TD=i),i}),n()(),t(15,"div",5)(16,"label",6),r(17,"Groupe Anglais"),n(),t(18,"input",9),u("ngModelChange",function(i){return c(e.filtres.id_groupe_Anglais,i)||(e.filtres.id_groupe_Anglais=i),i}),n()(),t(19,"div",5)(20,"label",6),r(21,"Email \xE9tudiant"),n(),t(22,"input",10),u("ngModelChange",function(i){return c(e.filtres.email,i)||(e.filtres.email=i),i}),n()(),t(23,"div",5)(24,"label",6),r(25,"Date unique"),n(),t(26,"input",11),u("ngModelChange",function(i){return c(e.filtres.date,i)||(e.filtres.date=i),i}),n()(),t(27,"div",5)(28,"label",6),r(29,"Plage de dates"),n(),t(30,"div",12)(31,"input",13),u("ngModelChange",function(i){return c(e.filtres.from,i)||(e.filtres.from=i),i}),n(),t(32,"input",14),u("ngModelChange",function(i){return c(e.filtres.to,i)||(e.filtres.to=i),i}),n()()(),t(33,"div",5)(34,"label",6),r(35,"Type"),n(),t(36,"select",15),u("ngModelChange",function(i){return c(e.filtres.type,i)||(e.filtres.type=i),i}),t(37,"option",16),r(38,"-- Tous --"),n(),t(39,"option",17),r(40,"Pr\xE9sents"),n(),t(41,"option",18),r(42,"Absents"),n()()(),t(43,"div",19)(44,"div",20)(45,"input",21),u("ngModelChange",function(i){return c(e.filtres.includeDetails,i)||(e.filtres.includeDetails=i),i}),n(),t(46,"label",22),r(47,"Afficher infos techniques"),n()()()(),t(48,"div",23)(49,"button",24),r(50,"\u{1F50D} Appliquer les filtres"),n(),t(51,"button",25),b("click",function(){return e.exporter()}),r(52,"\u{1F4C1} Exporter"),n()()(),t(53,"div",26)(54,"h5",27),r(55,"R\xE9sultats"),n(),t(56,"div",28)(57,"table",29)(58,"thead")(59,"tr")(60,"th"),r(61,"\xC9tudiant"),n(),t(62,"th"),r(63,"Cours"),n(),t(64,"th"),r(65,"D\xE9but"),n(),t(66,"th"),r(67,"Fin"),n(),t(68,"th"),r(69,"Pr\xE9sence"),n(),_(70,H,2,0,"th",30)(71,V,2,0,"th",30)(72,z,2,0,"th",30),n()(),t(73,"tbody"),_(74,Q,14,10,"tr",31)(75,X,3,0,"tr",30),n()()()()()(),h(76,"app-footer")),o&2&&(a(10),m("ngModel",e.filtres.promo),a(4),m("ngModel",e.filtres.id_groupe_TD),a(4),m("ngModel",e.filtres.id_groupe_Anglais),a(4),m("ngModel",e.filtres.email),a(4),m("ngModel",e.filtres.date),a(5),m("ngModel",e.filtres.from),a(),m("ngModel",e.filtres.to),a(4),m("ngModel",e.filtres.type),a(9),m("ngModel",e.filtres.includeDetails),a(25),d("ngIf",e.filtres.includeDetails),a(),d("ngIf",e.filtres.includeDetails),a(),d("ngIf",e.filtres.includeDetails),a(2),d("ngForOf",e.resultats),a(),d("ngIf",e.resultats.length===0))},dependencies:[I,R,w,M,x,A,j,k,B,U,W,v,F,P,L,O,N],encapsulation:2})};export{q as RapportAbsenceComponent};
