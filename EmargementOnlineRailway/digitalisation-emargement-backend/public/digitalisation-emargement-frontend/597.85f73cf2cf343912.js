"use strict";(self.webpackChunkdigitalisation_emargement_frontend=self.webpackChunkdigitalisation_emargement_frontend||[]).push([[597],{597:(p,i,a)=>{a.r(i),a.d(i,{GenerationQrComponent:()=>h});var u=a(177),c=a(1626),e=a(8457),l=a(3242);const m=["qrCanvas"];function d(s,g){1&s&&(e.j41(0,"p",8),e.EFF(1," Scannez ce code avec votre t\xe9l\xe9phone \xe9tudiant pour \xe9marger. "),e.k0s())}let h=(()=>{class s{route;router;http;qrCanvas;qrMessage="Initialisation...";qr=null;intervalId=null;compteur=90;BASE_URL="https://emargementonline-production.up.railway.app/api";creneauId="";constructor(n,t,r){this.route=n,this.router=t,this.http=r}ngOnInit(){this.creneauId=this.route.snapshot.queryParams.creneau_id;const t=localStorage.getItem("_TOKEN_UTILISATEUR");if(!t)return console.warn("\u{1f6ab} Token manquant \u2014 redirection vers l'accueil"),void this.router.navigate(["/accueil"]);const r=JSON.parse(t).token,o=(new c.Lr).set("Authorization",`Bearer ${r}`);this.demarrerGeneration(o)}demarrerGeneration(n){this.refreshQr(n),this.intervalId=setInterval(()=>{this.refreshQr(n)},5e3)}refreshQr(n){this.http.post(`${this.BASE_URL}/creneaux/${this.creneauId}/generate-qr`,{},{headers:n}).subscribe({next:t=>{const r=`https://emargementonline-production.up.railway.app/scan/${t.token}`;this.qrMessage=`QR actif \u2192 ${r}`,this.compteur=90,this.dessinerQR(r)},error:t=>{console.error(t),this.qrMessage="\u274c Erreur g\xe9n\xe9ration"}})}dessinerQR(n){this.qr?this.qr.value=n:this.qr=new QRious({element:this.qrCanvas.nativeElement,size:200,value:n})}ngOnDestroy(){this.intervalId&&clearInterval(this.intervalId)}static \u0275fac=function(t){return new(t||s)(e.rXU(l.nX),e.rXU(l.Ix),e.rXU(c.Qq))};static \u0275cmp=e.VBU({type:s,selectors:[["app-generation-qr"]],viewQuery:function(t,r){if(1&t&&e.GBs(m,7),2&t){let o;e.mGM(o=e.lsd())&&(r.qrCanvas=o.first)}},decls:13,vars:3,consts:[["qrCanvas",""],[1,"grayed-background","main-content","d-flex","justify-content-center","align-items-center","vh-100"],[1,"card","p-4","text-center","shadow","rounded",2,"width","320px","max-width","90vw"],[1,"fw-bold","mb-3"],[1,"mb-2","text-muted","small"],["width","200","height","200",1,"my-3","mx-auto","border","rounded",2,"background","white"],[1,"text-muted","small","mt-2"],["class","text-secondary small mt-3",4,"ngIf"],[1,"text-secondary","small","mt-3"]],template:function(t,r){1&t&&(e.j41(0,"main",1)(1,"div",2)(2,"h5",3),e.EFF(3,"\u{1f393} QR Code d'\xc9margement"),e.k0s(),e.j41(4,"div",4),e.EFF(5," \u23f3 Renouvellement dans "),e.j41(6,"strong"),e.EFF(7),e.k0s()(),e.nrm(8,"canvas",5,0),e.j41(10,"p",6),e.EFF(11),e.k0s(),e.DNE(12,d,2,0,"p",7),e.k0s()()),2&t&&(e.R7$(7),e.SpI("",r.compteur,"s"),e.R7$(4),e.JRh(r.qrMessage),e.R7$(),e.Y8G("ngIf",r.qrMessage.includes("QR actif")))},dependencies:[u.MD,u.bT],encapsulation:2})}return s})()}}]);